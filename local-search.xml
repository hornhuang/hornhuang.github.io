<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ç¼©æ”¾æ‰‹åŠ¿ ScaleGestureDetector  æºç è§£æï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</title>
    <link href="undefined2019/10/11/%E7%BC%A9%E6%94%BE%E6%89%8B%E5%8A%BF%20ScaleGestureDetector%20%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%8C%E8%BF%99%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86/"/>
    <url>2019/10/11/%E7%BC%A9%E6%94%BE%E6%89%8B%E5%8A%BF%20ScaleGestureDetector%20%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%EF%BC%8C%E8%BF%99%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86/</url>
    
    <content type="html"><![CDATA[<p>å…¶å®åœ¨æˆ‘ä»¬æ—¥å¸¸çš„ç¼–ç¨‹ä¸­ï¼Œå¯¹äºç¼©æ”¾æ‰‹åŠ¿çš„ä½¿ç”¨å¹¶ä¸æ˜¯å¾ˆç»å¸¸ï¼Œè¿™ä¸€æ‰‹åŠ¿ä¸»è¦æ˜¯ç”¨åœ¨å›¾ç‰‡æµè§ˆæ–¹é¢ï¼Œæ¯”å¦‚ä¸‹æ–¹ä¾‹å­ã€‚ä½†æ˜¯ï¼ˆæ•²é‡ç‚¹ï¼‰ï¼Œä½œä¸º Android å…¥é—¨çš„åŸºç¡€æ¥è¯´ï¼Œå­¦ä¹  ScaleGestureDetector çš„ä½¿ç”¨ï¼Œç®—æ˜¯ä¸å¾—ä¸è¿‡çš„ä¸€é“åï¼Œå¥½åœ¨ ScaleGestureDetector ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œå°±æ˜¯æºç åˆ†æä¸Šå¾—èŠ±äº›åŠŸå¤«ã€‚</p><blockquote><p>æœ¬æ–‡é¦–å…ˆå°†ç®€å•çš„ä»‹ç»ä¸‹ ScaleGestureDetector çš„ä½¿ç”¨ï¼Œåœ¨é‡ç‚¹ç»™å¤§å®¶åˆ†æä¸‹æºç ï¼ˆç”±äºæºç æ–¹é¢æ˜¯æˆ‘è‡ªå·±çš„ç†è§£ï¼Œå¯èƒ½æœ‰åå·®ï¼Œå¸Œæœ›å„ä½å¤§ä½¬èƒ½åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼Œä¸‡åˆ†æ„Ÿè°¢ï½ï¼‰</p></blockquote><img src="https://user-gold-cdn.xitu.io/2019/6/27/16b996688722ec94?w=1280&h=904&f=jpeg&s=235091" srcset="/img/loading.gif" width="500" height="300" align="center"><hr><h1 id="ScaleGestureDetector-ä½¿ç”¨"><a href="#ScaleGestureDetector-ä½¿ç”¨" class="headerlink" title="ScaleGestureDetector ä½¿ç”¨"></a>ScaleGestureDetector ä½¿ç”¨</h1><p>ScaleGestureDetector åŒ…æ‹¬ä¸€ä¸ªç›‘å¬å™¨ï¼Œä»¥åŠå®ƒæ‰€æœ‰æ–¹æ³•çš„ç©ºå®ç°ï¼š</p><table><thead><tr><th>åç§°</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>ScaleGestureDetector</td><td>ç¼©æ”¾æ‰‹åŠ¿çš„ç›‘å¬å™¨</td></tr><tr><td>SimpleOnScaleGestureListener</td><td>è¯¥ç›‘å¬å™¨çš„ç©ºå®ç°ï¼Œåœ¨å…¶ä¸­é‡å†™æ–¹æ³•</td></tr></tbody></table><h3 id="ScaleGestureDetector-æ–¹æ³•"><a href="#ScaleGestureDetector-æ–¹æ³•" class="headerlink" title="ScaleGestureDetector æ–¹æ³•"></a>ScaleGestureDetector æ–¹æ³•</h3><table><thead><tr><th>åç§°</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>onScaleBegin</td><td>å½“ &gt;= 2 ä¸ªæ‰‹æŒ‡ç¢°è§¦å±å¹•æ—¶è°ƒç”¨ï¼Œè‹¥è¿”å› false åˆ™å¿½ç•¥æ”¹äº‹ä»¶è°ƒç”¨</td></tr><tr><td>onScale</td><td>æ»‘åŠ¨ï¼ˆç¼©æ”¾ï¼‰è¿‡ç¨‹ä¸­è°ƒç”¨ï¼Œè‹¥æˆåŠŸå¤„ç†ï¼Œåˆ™ç”¨æˆ·è¿”å› trueï¼Œç›‘å¬å™¨ç»§ç»­è®°å½•ä¸‹ä¸€ä¸ªç¼©æ”¾ç­‰åŠ¨ä½œï¼Œè‹¥ä¸º false è¡¨æ˜æ•°æ®æœªå¤„ç†ï¼Œåˆ™ç›‘å¬å™¨ç»§ç»­ç§¯ç´¯</td></tr><tr><td>onScaleEnd</td><td>å…¨éƒ¨æ‰‹æŒ‡ç¦»å¼€å±å¹•ï¼Œç»“æŸç›‘å¬</td></tr></tbody></table><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‰‹åŠ¿ç›‘å¬ä¼šç»“åˆè‡ªå®šä¹‰ View æ¥è®²ï¼Œè¿™é‡Œæˆ‘ç»™å‡ºä¸€ä¸ªæœ€ç®€å•çš„ä½¿ç”¨ï¼Œå…·ä½“çš„ä½¿ç”¨å®ä¾‹ï¼Œä»¥åå†ç»“åˆè‡ªå®šä¹‰ View è®²è®²ã€‚</p><pre><code class="java">    private void iniScaleGestureListener(){        mListener = new ScaleGestureDetector.SimpleOnScaleGestureListener(){            @Override            public boolean onScaleBegin(ScaleGestureDetector detector) {                return super.onScaleBegin(detector);            }            @Override            public boolean onScale(ScaleGestureDetector detector) {                MyLog.d(&quot;X:&quot; + detector.getFocusX());                MyLog.d(&quot;Y:&quot; + detector.getFocusY());                MyLog.d(&quot;scale:&quot; + detector.getScaleFactor());                return super.onScale(detector);            }            @Override            public void onScaleEnd(ScaleGestureDetector detector) {                super.onScaleEnd(detector);            }        };        detector = new ScaleGestureDetector(getContext(), mListener);    }    @Override    public boolean onTouchEvent(MotionEvent event) {        detector.onTouchEvent(event);        return true;    }</code></pre><hr><h1 id="ScaleGestureDetector-çš„ä½¿ç”¨"><a href="#ScaleGestureDetector-çš„ä½¿ç”¨" class="headerlink" title="ScaleGestureDetector çš„ä½¿ç”¨"></a>ScaleGestureDetector çš„ä½¿ç”¨</h1><p>ScaleGestureDetector åœ¨å…·ä½“é¡¹ç›®çš„ä½¿ç”¨æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘æ‰“ç®—è¿‡æ®µæ—¶é—´ç»“åˆè‡ªå®šä¹‰ View å†™ä¸€ç¯‡ç”¨æ¥æ€»ç»“ï¼Œæ‰€ä»¥è¿™ç¯‡æˆ‘ä»¬å°±å…ˆäº†è§£ä¸‹ ScaleGestureDetector çš„åŸºæœ¬ä½¿ç”¨ã€‚</p><hr><h1 id="ScaleGestureDetector-æºç åˆ†æ"><a href="#ScaleGestureDetector-æºç åˆ†æ" class="headerlink" title="ScaleGestureDetector æºç åˆ†æ"></a>ScaleGestureDetector æºç åˆ†æ</h1><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬è¿›å…¥æœ¬ç« é‡ç‚¹ï¼ŒScaleGestureDetector æºç åˆ†æï¼Œæ•²é»‘æ¿æ•²é»‘æ¿ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ‰“å¼€ ScaleGestureDetector çš„æºç å¯ä»¥çœ‹åˆ°ï¼Œå‡ ä¹æ‰€æœ‰çš„ä»£ç éƒ½é›†ä¸­åœ¨äº† onTouchEvent è¿™ä¸ªæ–¹æ³•ä¸Šï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘å°±ä¸»è¦ç»™å¤§å®¶ä»‹ç»è¿™ä¸ªæ–¹æ³•çš„å®ç°ã€‚</p><h2 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šå‰æœŸå‡†å¤‡"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šå‰æœŸå‡†å¤‡" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šå‰æœŸå‡†å¤‡"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼šå‰æœŸå‡†å¤‡</h2><pre><code class="java">        if (mInputEventConsistencyVerifier != null) {            mInputEventConsistencyVerifier.onTouchEvent(event, 0);        }        mCurrTime = event.getEventTime();        final int action = event.getActionMasked();        // Forward the event to check for double tap gesture        if (mQuickScaleEnabled) {            mGestureDetector.onTouchEvent(event);        }        final int count = event.getPointerCount();        final boolean isStylusButtonDown =                (event.getButtonState() &amp; MotionEvent.BUTTON_STYLUS_PRIMARY) != 0;</code></pre><h3 id="mInputEventConsistencyVerifier"><a href="#mInputEventConsistencyVerifier" class="headerlink" title="mInputEventConsistencyVerifier"></a>mInputEventConsistencyVerifier</h3><ul><li>è¾“å…¥äº‹ä»¶ä¸€è‡´æ€§éªŒè¯å™¨ @æœ‰é“</li><li>æ ¹æ®åå­—ä»¥åŠå‰é¢çš„å®šä¹‰</li><li>æˆ‘ä»¬å¯ä»¥çŒœæµ‹è¿™ä¸ªå¯¹è±¡åº”è¯¥æ˜¯æ‰‹åŠ¿ç›‘å¬ Event æ˜¯å¦æ³¨å†Œï¼ˆè¿æ¥åˆ°ç¡¬ä»¶ï¼‰</li><li>æ‰€ä»¥ï¼Œå¦‚æœä»–ä¸ºç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨è¿™é‡Œè°ƒç”¨ onTouchEvent è¿›è¡Œæ³¨å†Œ</li></ul><pre><code class="java">        if (mInputEventConsistencyVerifier != null) {            mInputEventConsistencyVerifier.onTouchEvent(event, 0);        }</code></pre><h3 id="mCurrTime"><a href="#mCurrTime" class="headerlink" title="mCurrTime"></a>mCurrTime</h3><ul><li>è·å¾—äº‹ä»¶å‘ç”Ÿæ—¶çš„æ—¶é—´</li></ul><pre><code class="java">        mCurrTime = event.getEventTime();</code></pre><h3 id="action"><a href="#action" class="headerlink" title="action"></a>action</h3><ul><li>è·å¾—äº‹ä»¶ç±»å‹</li></ul><pre><code class="java">        final int action = event.getActionMasked();</code></pre><h3 id="mQuickScaleEnabled"><a href="#mQuickScaleEnabled" class="headerlink" title="mQuickScaleEnabled"></a>mQuickScaleEnabled</h3><ul><li>Forward the event to check for double tap gesture</li><li>@æœ‰é“ è½¬å‘äº‹ä»¶ä»¥æ£€æŸ¥åŒå‡»æ‰‹åŠ¿</li><li>é¦–å…ˆæ˜¯ mQuickScaleEnabled è¿™ä¸ªå¯¹è±¡</li><li>ç¿»è¯‘è¿‡æ¥æ˜¯ï¼š @æœ‰é“ å¯ç”¨å¿«é€Ÿæ‰©å±•</li><li>ä½œç”¨å¤§æ¦‚å°±æ˜¯è°ƒç”¨åŒå‡»ç›‘å¬äº‹ä»¶ï¼Œæ¯”å¦‚åŒå‡»æœ€å¤§åŒ–</li></ul><pre><code class="java">        if (mQuickScaleEnabled) {            mGestureDetector.onTouchEvent(event);        }</code></pre><h3 id="count"><a href="#count" class="headerlink" title="count"></a>count</h3><ul><li>è·å¾—å±å¹•ä¸Šæ‰‹æŒ‡çš„æ•°ç›®</li></ul><pre><code class="java">        final int count = event.getPointerCount();</code></pre><h3 id="isStylusButtonDown"><a href="#isStylusButtonDown" class="headerlink" title="isStylusButtonDown"></a>isStylusButtonDown</h3><p> è¿™ä¸ªä¸»è¦æ˜¯ç”±äºåˆ¤æ–­æ‰‹å†™ç¬”æ˜¯å¦æŒ‰ä¸‹<br> ç”±äºæˆ‘ä»¬å¾ˆå°‘å¤„ç†æ‰‹å†™ç¬”ï¼Œæ‰€ä»¥è¿™é‡Œä¸åšè¿‡å¤šè¯´æ˜</p><pre><code class="java">         final boolean isStylusButtonDown =                (event.getButtonState() &amp; MotionEvent.BUTTON_STYLUS_PRIMARY) != 0;</code></pre><hr><h2 id="ç¬¬äºŒéƒ¨åˆ†ï¼šå¤„ç†ä¸æ‰‹åŠ¿å˜åŒ–"><a href="#ç¬¬äºŒéƒ¨åˆ†ï¼šå¤„ç†ä¸æ‰‹åŠ¿å˜åŒ–" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†ï¼šå¤„ç†ä¸æ‰‹åŠ¿å˜åŒ–"></a>ç¬¬äºŒéƒ¨åˆ†ï¼šå¤„ç†ä¸æ‰‹åŠ¿å˜åŒ–</h2><p> ç”¨æˆ·çš„ç¼©æ”¾æ‰‹åŠ¿ä¸æ€»æ˜¯ä¸€å®šçš„ï¼Œå°±æ˜¯è¯´å¯¹äºç”¨æˆ·è€Œè¨€ï¼Œéšæ—¶å¯èƒ½æœ‰æ‰‹æŒ‡ç¢°è§¦æˆ–ç¦»å¼€å±å¹•ï¼Œè¿™å°±ä½¿å¾—ç¼©æ”¾ä¸­å¿ƒçš„ï¼ˆç„¦ç‚¹ï¼‰éšæ—¶å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œè¿™éƒ¨åˆ†ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†è¿™ä¸€å˜åŒ–ï¼Œå¹¶åšå‡ºå“åº”ã€‚</p><pre><code class="java">         final boolean anchoredScaleCancelled =                mAnchoredScaleMode == ANCHORED_SCALE_MODE_STYLUS &amp;&amp; !isStylusButtonDown;        final boolean streamComplete = action == MotionEvent.ACTION_UP ||                action == MotionEvent.ACTION_CANCEL || anchoredScaleCancelled;        // å¦‚æœå‘ç”Ÿäº†ä¸Šé¢è¿™ç§å°åŠ¨ä½œï¼Œæˆ–è€…è¯´æœ‰ä¸€æ‰‹æŒ‡ç¦»å¼€äº†å±å¹•ï¼Œè¿›è¡Œè°ƒç”¨        if (action == MotionEvent.ACTION_DOWN || streamComplete) {            // Reset any scale in progress with the listener.            // If it&#39;s an ACTION_DOWN we&#39;re beginning a new event stream.            // This means the app probably didn&#39;t give us all the events. Shame on it.            if (mInProgress) {                mListener.onScaleEnd(this);                mInProgress = false;                mInitialSpan = 0;                mAnchoredScaleMode = ANCHORED_SCALE_MODE_NONE;            } else if (inAnchoredScaleMode() &amp;&amp; streamComplete) {                mInProgress = false;                mInitialSpan = 0;                mAnchoredScaleMode = ANCHORED_SCALE_MODE_NONE;            }            if (streamComplete) {                return true;            }        }</code></pre><h3 id="anchoredScaleCancelled"><a href="#anchoredScaleCancelled" class="headerlink" title="anchoredScaleCancelled"></a>anchoredScaleCancelled</h3><ul><li>@Google é”šå®šè§„æ¨¡å–æ¶ˆ</li><li>æˆ‘çš„ç†è§£æ˜¯ï¼šç”¨äºåˆ¤æ–­æ»‘åŠ¨äº‹ä»¶æ˜¯å¦è¢«å–æ¶ˆ</li></ul><pre><code class="java">        final boolean anchoredScaleCancelled =                mAnchoredScaleMode == ANCHORED_SCALE_MODE_STYLUS &amp;&amp; !isStylusButtonDown;</code></pre><h3 id="streamComplete"><a href="#streamComplete" class="headerlink" title="streamComplete"></a>streamComplete</h3><ul><li>@Google Translate: æµå®Œæˆ</li><li>æˆ‘çš„ç†è§£æ˜¯ï¼Œè¿™ä¸ªå¸ƒå°”å˜é‡ç”¨äºæ ‡è®°</li><li>å½“å‰åŠ¨ä½œæ˜¯å¦å®Œæˆ</li><li>æˆ‘è¿™é‡Œè¯´çš„åŠ¨ä½œæœ‰ä¸¤ç§</li><li>è¿™é‡ŒæŒ‡çš„æ˜¯ï¼šåœ¨å¤§åŠ¨ä½œå¦‚ä¸‰æŒ‡è§¦å±æ”¾å¤§è¿‡ç¨‹ä¸­ï¼Œåˆä¸€ä¸ªæ‰‹æŒ‡ç¦»å¼€äº†å±å¹•è¿™ç§</li><li>åœ¨å¤§åŠ¨ä½œä¸‰æŒ‡è§¦å±ä¸­å‘ç”Ÿçš„ä¸€ä¸ªå°åŠ¨ä½œï¼Œç¦»å¼€ä¸€æŒ‡</li></ul><pre><code class="java">        final boolean streamComplete = action == MotionEvent.ACTION_UP ||                action == MotionEvent.ACTION_CANCEL || anchoredScaleCancelled;</code></pre><h3 id="action-MotionEvent-ACTION-DOWN-streamComplete"><a href="#action-MotionEvent-ACTION-DOWN-streamComplete" class="headerlink" title="action == MotionEvent.ACTION_DOWN || streamComplete"></a>action == MotionEvent.ACTION_DOWN || streamComplete</h3><ul><li>å¦‚æœå‘ç”Ÿäº†ä¸Šé¢è¿™ç§å°åŠ¨ä½œï¼Œæˆ–è€…è¯´æœ‰ä¸€æ‰‹æŒ‡ç¦»å¼€äº†å±å¹•ï¼Œå°±è¿›è¡Œè°ƒç”¨</li></ul><pre><code class="java">if (action == MotionEvent.ACTION_DOWN || streamComplete) {...}</code></pre><h3 id="if-mInProgress"><a href="#if-mInProgress" class="headerlink" title="if (mInProgress)"></a>if (mInProgress)</h3><ul><li>@google Translateï¼šé‡ç½®ä¾¦å¬å™¨æ­£åœ¨è¿›è¡Œçš„ä»»ä½•ç¼©æ”¾ã€‚</li><li>å¦‚æœæ˜¯ACTION_DOWNï¼Œæˆ‘ä»¬å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹ä»¶æµã€‚</li><li>è¿™æ„å‘³ç€åº”ç”¨ç¨‹åºå¯èƒ½æ²¡æœ‰ç»™æˆ‘ä»¬æ‰€æœ‰çš„äº‹ä»¶ã€‚å¾ˆé—æ†¾ã€‚</li><li>é¦–å…ˆåˆ¤æ–­è¯¥è¿›ç¨‹ï¼ˆä»ç¬¬ä¸€ä¸ªæ‰‹æŒ‡ç¢°ä¸Šå±å¹•ï¼Œåˆ°æœ€åä¸€ä¸ªæ‰‹æŒ‡ç¦»å¼€å±å¹•ä¸ºæ­¢ï¼‰æ˜¯å¦ç»“æŸ</li><li>å¦‚æœä»åœ¨è¿è¡Œä¸­ï¼Œè¿™è°ƒç”¨å›è°ƒæ–¹æ³•ï¼šonScaleEnd ä½¿å…¶ç»“æŸ</li></ul><pre><code class="java">            if (mInProgress) {                mListener.onScaleEnd(this);                mInProgress = false;                mInitialSpan = 0;                mAnchoredScaleMode = ANCHORED_SCALE_MODE_NONE;            }</code></pre><h3 id="else-if-inAnchoredScaleMode-amp-amp-streamComplete"><a href="#else-if-inAnchoredScaleMode-amp-amp-streamComplete" class="headerlink" title="else if (inAnchoredScaleMode() &amp;&amp; streamComplete)"></a>else if (inAnchoredScaleMode() &amp;&amp; streamComplete)</h3><ul><li>å¦‚æœå½“å‰è¿›ç¨‹å·²ç»ç»“æŸ</li><li>åˆ¤æ–­ mAnchoredScaleMode æ˜¯å¦ä¸º ANCHORED_SCALE_MODE_STYLUS çŠ¶æ€</li><li>åŒæ—¶åˆ¤æ–­æ“ä½œæµ streamComplete æ˜¯å¦å®Œæˆ</li><li>éƒ½ç¬¦åˆçš„æƒ…å†µä¸‹ç»“æŸè¿™ä¸€æ‰‹åŠ¿å˜åŒ–</li></ul><pre><code class="java">            else if (inAnchoredScaleMode() &amp;&amp; streamComplete) {                mInProgress = false;                mInitialSpan = 0;                mAnchoredScaleMode = ANCHORED_SCALE_MODE_NONE;            }</code></pre><h3 id="if-streamComplete"><a href="#if-streamComplete" class="headerlink" title="if (streamComplete)"></a>if (streamComplete)</h3><ul><li>ç»“æŸæœ¬æ¬¡ onTouchEvent æ–¹æ³•çš„è°ƒç”¨ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è°ƒç”¨å‘ç”Ÿ</li></ul><pre><code class="java">            if (streamComplete) {                return true;            }</code></pre><p>æ€»ç»“ï¼š å¯ä»¥çœ‹åˆ°ï¼Œå½“è§¦å‘ down æˆ–è€…è§¦å‘ upï¼Œcancel æ—¶ï¼Œå¦‚æœä¹‹å‰å¤„äºç¼©æ”¾è®¡ç®—çš„çŠ¶æ€ï¼Œä¼šå°†å…¶çŠ¶æ€é‡ç½®ï¼Œ å¹¶è°ƒç”¨ onScaleEnd æ–¹æ³•ã€‚</p><hr><h2 id="è¿›å…¥é”šå®šæ¯”ä¾‹æ¨¡å¼"><a href="#è¿›å…¥é”šå®šæ¯”ä¾‹æ¨¡å¼" class="headerlink" title="è¿›å…¥é”šå®šæ¯”ä¾‹æ¨¡å¼"></a>è¿›å…¥é”šå®šæ¯”ä¾‹æ¨¡å¼</h2><ul><li>å½“åˆ¤æ–­ç”¨æˆ·åŠ¨ä½œï¼Œå¦‚æœä¸ºåŒå‡»è¿™ç±»ç‚¹å‡»äº‹ä»¶ï¼Œè¿›å…¥è¯¥æ¨¡å¼</li><li>ä¸æ­£å¸¸ç¼©æ”¾åŒºåˆ†ã€‚è¿™ä¸ªæ¨¡å¼åŠŸèƒ½ä¸€èˆ¬æ˜¯ï¼šåŒå‡»æœ€å¤§åŒ–å’Œæœ€å°åŒ–</li></ul><pre><code class="java">        if (!mInProgress &amp;&amp; mStylusScaleEnabled &amp;&amp; !inAnchoredScaleMode()                &amp;&amp; !streamComplete &amp;&amp; isStylusButtonDown) {            // Start of a button scale gesture            mAnchoredScaleStartX = event.getX();            mAnchoredScaleStartY = event.getY();            mAnchoredScaleMode = ANCHORED_SCALE_MODE_STYLUS;            mInitialSpan = 0;        }</code></pre><h3 id="mAnchoredScaleStartX-amp-mAnchoredScaleStartY"><a href="#mAnchoredScaleStartX-amp-mAnchoredScaleStartY" class="headerlink" title="mAnchoredScaleStartX &amp; mAnchoredScaleStartY"></a>mAnchoredScaleStartX &amp; mAnchoredScaleStartY</h3><ul><li>åæ–‡ä¸­å°†ç”¨äºé‡æ–°è®¡ç®—ç„¦ç‚¹</li></ul><pre><code class="java">            mAnchoredScaleStartX = event.getX();            mAnchoredScaleStartY = event.getY();</code></pre><h3 id="mAnchoredScaleMode"><a href="#mAnchoredScaleMode" class="headerlink" title="mAnchoredScaleMode"></a>mAnchoredScaleMode</h3><ul><li>èµ‹å€¼ä¹‹åï¼Œå†æ¬¡è°ƒç”¨ inAnchoredScaleMode() æ–¹æ³•ï¼Œè¿”å›å€¼å˜ä¸º true</li></ul><pre><code class="java">            mAnchoredScaleMode = ANCHORED_SCALE_MODE_STYLUS;</code></pre><h2 id="è®¡ç®—ç¼©æ”¾ä¸­å¿ƒ"><a href="#è®¡ç®—ç¼©æ”¾ä¸­å¿ƒ" class="headerlink" title="è®¡ç®—ç¼©æ”¾ä¸­å¿ƒ"></a>è®¡ç®—ç¼©æ”¾ä¸­å¿ƒ</h2><pre><code class="java">        final boolean configChanged = action == MotionEvent.ACTION_DOWN ||                action == MotionEvent.ACTION_POINTER_UP ||                action == MotionEvent.ACTION_POINTER_DOWN || anchoredScaleCancelled;        final boolean pointerUp = action == MotionEvent.ACTION_POINTER_UP;        final int skipIndex = pointerUp ? event.getActionIndex() : -1;        // Determine focal point        float sumX = 0, sumY = 0;        final int div = pointerUp ? count - 1 : count;        final float focusX;        final float focusY;        if (inAnchoredScaleMode()) {            // In anchored scale mode, the focal pt is always where the double tap            // or button down gesture started            focusX = mAnchoredScaleStartX;            focusY = mAnchoredScaleStartY;            if (event.getY() &lt; focusY) {                mEventBeforeOrAboveStartingGestureEvent = true;            } else {                mEventBeforeOrAboveStartingGestureEvent = false;            }        } else {            for (int i = 0; i &lt; count; i++) {                if (skipIndex == i) continue;                sumX += event.getX(i);                sumY += event.getY(i);            }            focusX = sumX / div;            focusY = sumY / div;        }</code></pre><h3 id="configChanged"><a href="#configChanged" class="headerlink" title="configChanged"></a>configChanged</h3><ul><li>å¸ƒå°”ç±»å‹é‡ï¼Œæ ‡å¿—ç€ä¸€ä¸ªæ“ä½œçš„å®Œæˆæˆ–è€…ç»“æŸï¼ˆæ‰‹æŒ‡ç¦»å¼€ï¼Œæ‰‹æŒ‡æŒ‰ä¸‹ï¼‰</li></ul><pre><code class="java">        final boolean configChanged = action == MotionEvent.ACTION_DOWN ||                action == MotionEvent.ACTION_POINTER_UP ||                action == MotionEvent.ACTION_POINTER_DOWN || anchoredScaleCancelled;</code></pre><h3 id="pointerUp"><a href="#pointerUp" class="headerlink" title="pointerUp"></a>pointerUp</h3><ul><li>å¸ƒå°”ç±»å‹é‡ï¼Œç”¨äºåˆ¤æ–­å½“å‰åŠ¨ä½œï¼Œæ˜¯å¦ä¸ºæ‰‹æŒ‡ç¦»å¼€ï¼ˆæŠ¬èµ·åŠ¨ä½œï¼‰</li></ul><pre><code class="java">        final boolean pointerUp = action == MotionEvent.ACTION_POINTER_UP;</code></pre><h3 id="skipIndex"><a href="#skipIndex" class="headerlink" title="skipIndex"></a>skipIndex</h3><ul><li>æ ‡è®°é‡ï¼Œåœ¨æ˜¯æ‰‹æŒ‡ç¦»å¼€çš„æƒ…å†µä¸‹ï¼Œæ ‡è®°ç¦»å¼€æ‰‹æŒ‡</li><li>åœ¨åé¢è®¡ç®—æ–°çš„ç„¦ç‚¹ä»£ç ä¸­ï¼Œè·³è¿‡è¯¥æ‰‹æŒ‡çš„æ ‡è®°ç‚¹åæ ‡ï¼Œè¿›è¡Œè®¡ç®—</li></ul><pre><code class="java">        final int skipIndex = pointerUp ? event.getActionIndex() : -1;</code></pre><h3 id="åˆå§‹åŒ–è®¡ç®—æ‰€éœ€ä¸´æ—¶å˜é‡"><a href="#åˆå§‹åŒ–è®¡ç®—æ‰€éœ€ä¸´æ—¶å˜é‡" class="headerlink" title="åˆå§‹åŒ–è®¡ç®—æ‰€éœ€ä¸´æ—¶å˜é‡"></a>åˆå§‹åŒ–è®¡ç®—æ‰€éœ€ä¸´æ—¶å˜é‡</h3><pre><code class="java">        // Determine focal point        float sumX = 0, sumY = 0;        // å¦‚æœæ˜¯æŠ¬èµ·æ‰‹æŒ‡ï¼Œåˆ™å½“å‰æ‰‹æŒ‡æ•°å‡1ï¼Œå¦åˆ™ä¸å˜        final int div = pointerUp ? count - 1 : count;        final float focusX;        final float focusY;</code></pre><h3 id="åˆ¤æ–­æ˜¯å¦ä¸ºé”šå®šæ¯”ä¾‹æ¨¡å¼"><a href="#åˆ¤æ–­æ˜¯å¦ä¸ºé”šå®šæ¯”ä¾‹æ¨¡å¼" class="headerlink" title="åˆ¤æ–­æ˜¯å¦ä¸ºé”šå®šæ¯”ä¾‹æ¨¡å¼"></a>åˆ¤æ–­æ˜¯å¦ä¸ºé”šå®šæ¯”ä¾‹æ¨¡å¼</h3><ul><li>æ˜¯çš„è¯ç›´æ¥å°†ç‚¹å‡»æ—¶è®°ä¸‹çš„ç‚¹ï¼Œä½œä¸ºç„¦ç‚¹</li><li>ä¸æ˜¯çš„è¯ï¼ŒæŠŠæ‰€æœ‰ç‚¹ç´¯åŠ æ±‚å’Œï¼Œé™¤ä»¥æ€»ä¸ªæ•°ï¼Œè®¡ç®—å¹³å‡å€¼</li></ul><pre><code class="java">        if (inAnchoredScaleMode()) {            // In anchored scale mode, the focal pt is always where the double tap            // or button down gesture started            // åœ¨é”šå®šæ¯”ä¾‹æ¨¡å¼ä¸­ï¼Œç„¦ç‚¹ptå§‹ç»ˆæ˜¯åŒå‡»çš„ä½ç½®ï¼Œæˆ–æŒ‰ä¸‹æ‰‹åŠ¿å¼€å§‹            focusX = mAnchoredScaleStartX;            focusY = mAnchoredScaleStartY;            if (event.getY() &lt; focusY) {                mEventBeforeOrAboveStartingGestureEvent = true;            } else {                mEventBeforeOrAboveStartingGestureEvent = false;            }        } else {            for (int i = 0; i &lt; count; i++) {                if (skipIndex == i) continue;                sumX += event.getX(i);                sumY += event.getY(i);            }            focusX = sumX / div;            focusY = sumY / div;        }</code></pre><hr><h2 id="ç®—ç¼©æ”¾æ¯”ä¾‹"><a href="#ç®—ç¼©æ”¾æ¯”ä¾‹" class="headerlink" title="ç®—ç¼©æ”¾æ¯”ä¾‹"></a>ç®—ç¼©æ”¾æ¯”ä¾‹</h2><ul><li>è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯è®¡ç®—å„ä¸ªæ‰‹æŒ‡åˆ°ç„¦ç‚¹çš„å¹³å‡è·ç¦»ï¼Œåœ¨ç”¨æˆ·æ‰‹æŒ‡ç§»åŠ¨åç”¨æ–°çš„å¹³å‡è·ç¦»é™¤ä»¥æ—§çš„å¹³å‡è·ç¦»ï¼Œå¹¶ä»¥æ­¤è®¡ç®—å¾—å‡ºç¼©æ”¾æ¯”ä¾‹ã€‚</li></ul><pre><code class="java">        // Determine average deviation from focal point @Google translate         float devSumX = 0, devSumY = 0;        for (int i = 0; i &lt; count; i++) {            if (skipIndex == i) continue;            // Convert the resulting diameter into a radius.            devSumX += Math.abs(event.getX(i) - focusX);            devSumY += Math.abs(event.getY(i) - focusY);        }        final float devX = devSumX / div;        final float devY = devSumY / div;        // Span is the average distance between touch points through the focal point;        // i.e. the diameter of the circle with a radius of the average deviation from        // the focal point.        final float spanX = devX * 2;        final float spanY = devY * 2;        final float span;        if (inAnchoredScaleMode()) {            span = spanY;        } else {            span = (float) Math.hypot(spanX, spanY);        }</code></pre><h3 id="è®¡ç®—å¹³å‡åå·®"><a href="#è®¡ç®—å¹³å‡åå·®" class="headerlink" title="è®¡ç®—å¹³å‡åå·®"></a>è®¡ç®—å¹³å‡åå·®</h3><ul><li>ç¡®å®šç„¦ç‚¹çš„å¹³å‡åå·®</li></ul><pre><code class="java">        float devSumX = 0, devSumY = 0;        for (int i = 0; i &lt; count; i++) {            if (skipIndex == i) continue;            // Convert the resulting diameter into a radius.            devSumX += Math.abs(event.getX(i) - focusX);            devSumY += Math.abs(event.getY(i) - focusY);        }        final float devX = devSumX / div;        final float devY = devSumY / div;</code></pre><h3 id="è®¡ç®—ç¼©æ”¾æ¯”ä¾‹"><a href="#è®¡ç®—ç¼©æ”¾æ¯”ä¾‹" class="headerlink" title="è®¡ç®—ç¼©æ”¾æ¯”ä¾‹"></a>è®¡ç®—ç¼©æ”¾æ¯”ä¾‹</h3><ul><li>è·¨åº¦æ˜¯é€šè¿‡ç„¦ç‚¹çš„è§¦æ‘¸ç‚¹ä¹‹é—´çš„å¹³å‡è·ç¦»;</li><li>å³åœ†çš„ç›´å¾„ï¼Œå…¶åŠå¾„ä¸ºå¹³å‡åå·®</li><li>è¿™é‡Œçš„ Math.hypot(spanX, spanY) æ–¹æ³•ï¼Œç›¸å½“äº sqrt(x<em>x + y</em>y)</li></ul><pre><code class="java">        final float spanX = devX * 2;        final float spanY = devY * 2;        final float span;        if (inAnchoredScaleMode()) {            span = spanY;        } else {            span = (float) Math.hypot(spanX, spanY);        }</code></pre><hr><h2 id="ç»“æŸç¼©æ”¾äº‹ä»¶"><a href="#ç»“æŸç¼©æ”¾äº‹ä»¶" class="headerlink" title="ç»“æŸç¼©æ”¾äº‹ä»¶"></a>ç»“æŸç¼©æ”¾äº‹ä»¶</h2><ul><li>@Google Translateï¼šæ ¹æ®éœ€è¦è°ƒåº¦å¼€å§‹/ç»“æŸäº‹ä»¶ã€‚</li><li>å¦‚æœé…ç½®å‘ç”Ÿæ›´æ”¹ï¼Œè¯·é€šè¿‡å¼€å§‹é€šçŸ¥åº”ç”¨é‡ç½®å…¶å½“å‰çŠ¶æ€</li><li>ä¸€ä¸ªæ–°çš„æ¯”ä¾‹äº‹ä»¶æµã€‚</li><li>è¿™é‡Œå°±ä¸åšå¤ªå¤šæè¿°ï¼Œä¸»è¦å°±æ˜¯ï¼š</li><li>åˆ¤æ–­æ˜¯ä¸æ˜¯æ‰€æœ‰æ‰‹æŒ‡éƒ½ç¦»å¼€äº†å±å¹•</li><li>å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆç´¢å‘½è¿™ä¸ªç¼©æ”¾è¿›ç¨‹ç»“æŸäº†</li><li>åˆ™ä¿å­˜å½“å‰ç¼©æ”¾çš„æ•°æ®</li><li>è°ƒç”¨ onScaleEnd æ–¹æ³•ï¼Œç»“æŸå½“å‰æ“ä½œ</li></ul><pre><code class="java">        final boolean wasInProgress = mInProgress;        mFocusX = focusX;        mFocusY = focusY;        if (!inAnchoredScaleMode() &amp;&amp; mInProgress &amp;&amp; (span &lt; mMinSpan || configChanged)) {            mListener.onScaleEnd(this);            mInProgress = false;            mInitialSpan = span;        }        if (configChanged) {            mPrevSpanX = mCurrSpanX = spanX;            mPrevSpanY = mCurrSpanY = spanY;            mInitialSpan = mPrevSpan = mCurrSpan = span;        }</code></pre><h2 id="è§¦å‘-onScaleBegin-å¼€å§‹ç¼©æ”¾"><a href="#è§¦å‘-onScaleBegin-å¼€å§‹ç¼©æ”¾" class="headerlink" title="è§¦å‘ onScaleBegin å¼€å§‹ç¼©æ”¾"></a>è§¦å‘ onScaleBegin å¼€å§‹ç¼©æ”¾</h2><ul><li>å½“æ‰‹æŒ‡ç§»åŠ¨çš„è·ç¦»è¶…è¿‡ä¸€å®šæ•°å€¼(æ•°å€¼å¤§å°ç”±ç³»ç»Ÿå®šä¹‰)åï¼Œä¼šè§¦å‘ onScaleBegin æ–¹æ³•</li><li>å¦‚æœç”¨æˆ·åœ¨ onScaleBegin æ–¹æ³•é‡Œé¢è¿”å›äº† trueï¼Œåˆ™æ¥å—äº‹ä»¶åï¼Œå°±ä¼šé‡ç½®ç¼©æ”¾ç›¸å…³æ•°å€¼ï¼Œå¹¶ä¸”å¼€å§‹ç§¯ç´¯ç¼©æ”¾å› å­ã€‚</li></ul><pre><code class="java">        final int minSpan = inAnchoredScaleMode() ? mSpanSlop : mMinSpan;        if (!mInProgress &amp;&amp; span &gt;= minSpan &amp;&amp;                (wasInProgress || Math.abs(span - mInitialSpan) &gt; mSpanSlop)) {            mPrevSpanX = mCurrSpanX = spanX;            mPrevSpanY = mCurrSpanY = spanY;            mPrevSpan = mCurrSpan = span;            mPrevTime = mCurrTime;            mInProgress = mListener.onScaleBegin(this);        }</code></pre><h2 id="é€šçŸ¥ç”¨æˆ·è¿›è¡Œç¼©æ”¾å¤„ç†"><a href="#é€šçŸ¥ç”¨æˆ·è¿›è¡Œç¼©æ”¾å¤„ç†" class="headerlink" title="é€šçŸ¥ç”¨æˆ·è¿›è¡Œç¼©æ”¾å¤„ç†"></a>é€šçŸ¥ç”¨æˆ·è¿›è¡Œç¼©æ”¾å¤„ç†</h2><ul><li>@ Google Translate: å¤„ç†åŠ¨ä½œ;ç„¦ç‚¹å’Œè·¨åº¦/æ¯”ä¾‹å› å­æ­£åœ¨å‘ç”Ÿå˜åŒ–ã€‚</li><li>è¿™å—ä»£ç çš„åŠŸèƒ½ä¸»è¦å°±æ˜¯é€šçŸ¥ç”¨æˆ·ï¼ˆç¼–ç¨‹è€…ï¼‰</li><li>æ ¹æ®è¿™äº›æ•°æ®è¿›è¡Œç¼©æ”¾</li></ul><pre><code class="java">        if (action == MotionEvent.ACTION_MOVE) {            mCurrSpanX = spanX;            mCurrSpanY = spanY;            mCurrSpan = span;            boolean updatePrev = true;            if (mInProgress) {                updatePrev = mListener.onScale(this);            }            if (updatePrev) {                mPrevSpanX = mCurrSpanX;                mPrevSpanY = mCurrSpanY;                mPrevSpan = mCurrSpan;                mPrevTime = mCurrTime;            }        }</code></pre><h3 id="updatePrev"><a href="#updatePrev" class="headerlink" title="updatePrev"></a>updatePrev</h3><ul><li>è¿™ä¸ªç”¨äºæ¥æ”¶ç”¨æˆ·çš„è¿”å›å€¼</li><li>åªè¦æˆ‘ä»¬æ”¾å› true ï¼Œç³»ç»Ÿå°±ä¼šä¿å­˜å½“å‰æ•°æ®</li><li>é‡æ–°è·å–å¹¶è®¡ç®—æ–°çš„æ•°æ®å’Œæ¯”ä¾‹</li><li>ç³»ç»Ÿé»˜è®¤è¿”å› false ç„¶åè¿›è¡Œä¸‹ä¸€æ¬¡äº‹ä»¶çš„è®¡ç®—</li></ul><pre><code class="java">            if (mInProgress) {                updatePrev = mListener.onScale(this);            }            if (updatePrev) {                mPrevSpanX = mCurrSpanX;                mPrevSpanY = mCurrSpanY;                mPrevSpan = mCurrSpan;                mPrevTime = mCurrTime;            }</code></pre><hr><h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>æˆ‘è¦è®²çš„æ‰€æœ‰å†…å®¹ï¼Œåˆ°è¿™é‡Œå°±å®Œå…¨ç»“æŸäº†</p><p>ç”±äºæºç æ˜¯æŒ‰ç…§æˆ‘è‡ªå·±çš„ç†è§£æ¥è®²çš„ï¼Œæ‰€ä»¥éš¾å…ä¼šæœ‰ä¸€äº›å‡ºå…¥</p><p>å¸Œæœ›å¤§å®¶èƒ½åœ¨è¯„è®ºåŒºä¸­å¸®æˆ‘æŒ‡å‡ºï¼Œè°¢è°¢ï½ ğŸ™</p>]]></content>
    
    
    <categories>
      
      <category>android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>android</tag>
      
      <tag>ScaleGestureDetector</tag>
      
      <tag>ç¼©æ”¾æ‰‹åŠ¿</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å•ä¾‹æ¨¡å¼-å…¨å±€å¯ç”¨çš„ context å¯¹è±¡ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</title>
    <link href="undefined2019/10/09/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F-%E5%85%A8%E5%B1%80%E5%8F%AF%E7%94%A8%E7%9A%84%20context%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E8%BF%99%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86/"/>
    <url>2019/10/09/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F-%E5%85%A8%E5%B1%80%E5%8F%AF%E7%94%A8%E7%9A%84%20context%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E8%BF%99%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å•ä¾‹æ¨¡å¼åœ¨å„ä¸ªæ–¹é¢éƒ½æœ‰ç€æä¸ºå¹¿æ³›çš„ä½¿ç”¨ï¼Œæ‰€è°“å•ä¾‹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ•´ä¸ªç¨‹åºä¸­åªæœ‰ä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å®ƒæˆåŠŸä¿è¯äº†æ•´ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå†…è¯¥ç±»çš„å¯¹è±¡åªèƒ½åˆ›å»ºä¸€æ¬¡ï¼Œå¹¶ä¸”æä¾›å…¨å±€å”¯ä¸€è®¿é—®è¯¥ç±»çš„æ–¹æ³•ï¼šgetInstance()</p></blockquote><hr><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><p>å…³äºå•ä¾‹æ¨¡å¼ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>æ‡’æ±‰æ¨¡å¼</li><li>é¥¿æ±‰æ¨¡å¼</li></ul><p>ç”±äºé¥¿æ±‰æ¨¡å¼æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½å°½é‡é‡‡ç”¨é¥¿æ±‰æ¨¡å¼ï¼Œå…·ä½“åŸå› å¸¸è§è¿™ä½å¤§ä½¬çš„åšæ–‡ï¼š<a href="https://www.jianshu.com/p/8b59089a12f6" target="_blank" rel="noopener">ç‚¹å‡»å‰å¾€</a></p><p>æœ¬æ–‡ä¸»è¦ç»“åˆ Android åˆ†æä¸‹å½“ä¾‹æ¨¡å¼åœ¨ Android ä¸­è·å¾—å…¨å±€å¯ç”¨çš„ Context å¯¹è±¡</p><hr><h3 id="æ­å»ºé¥¿æ±‰æ¨¡å¼åŸºæœ¬æ¡†æ¶"><a href="#æ­å»ºé¥¿æ±‰æ¨¡å¼åŸºæœ¬æ¡†æ¶" class="headerlink" title="æ­å»ºé¥¿æ±‰æ¨¡å¼åŸºæœ¬æ¡†æ¶"></a>æ­å»ºé¥¿æ±‰æ¨¡å¼åŸºæœ¬æ¡†æ¶</h3><p>å•ä¾‹æ¨¡å¼åŸºæœ¬æ–¹æ³•åŒ…æ‹¬</p><ul><li>ä¸€ä¸ªè¯¥ç±»å¯¹è±¡</li><li>è¯¥ç±»æ„é€ æ–¹æ³•</li><li>è·å¾—å•ä¾‹çš„æ–¹æ³•</li></ul><pre><code class="java">/**å•ä¾‹æ¨¡å¼ * * å‘æ•´ä¸ªåº”ç”¨æä¾› App (application) å•ä¾‹ */public class AppContext {    private static AppContext instance;    public AppContext(Context application){    }    public static AppContext getInstance() {        if (instance == null){            throw new RuntimeException();        }        return instance;    }}</code></pre><hr><h3 id="å¯¹å¤–æš´éœ²å®ä¾‹åŒ–å•ä¾‹çš„æ–¹æ³•"><a href="#å¯¹å¤–æš´éœ²å®ä¾‹åŒ–å•ä¾‹çš„æ–¹æ³•" class="headerlink" title="å¯¹å¤–æš´éœ²å®ä¾‹åŒ–å•ä¾‹çš„æ–¹æ³•"></a>å¯¹å¤–æš´éœ²å®ä¾‹åŒ–å•ä¾‹çš„æ–¹æ³•</h3><p>å¤–ç•Œè°ƒç”¨æ—¶ï¼Œå°†å…¨å±€çš„ context å¯¹è±¡ä¼ å…¥</p><pre><code class="java">    public static void init(Context context){        if (instance != null){            throw new RuntimeException();        }        instance = new AppContext(context);    }</code></pre><p>ä¿®æ”¹æ„é€ æ–¹æ³•ï¼š</p><ul><li>å°†å…¨å±€çš„ Context å¯¹è±¡ä¿å­˜åˆ°è¯¥å•ä¾‹ä¸­</li></ul><pre><code class="java">    private Context applicationContext;    public AppContext(Context application){        this.applicationContext = application;    }</code></pre><hr><h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><p>åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šï¼Œæš´éœ²è·å¾— Context å¯¹è±¡çš„æ–¹æ³•</p><pre><code class="java">/**å•ä¾‹æ¨¡å¼ * * å‘æ•´ä¸ªåº”ç”¨æä¾› App (application) å•ä¾‹ */public class AppContext {    private static AppContext instance;    private Context applicationContext;    public AppContext(Context application){        this.applicationContext = application;    }    public Context getApplicationContext() {        return applicationContext;    }    public static AppContext getInstance() {        if (instance == null){            throw new RuntimeException();        }        return instance;    }    public static void init(Context context){        if (instance != null){            throw new RuntimeException();        }        instance = new AppContext(context);    }    public static boolean isInitialized(){        return (instance != null);    }}</code></pre><hr><h1 id="å•ä¾‹çš„å®ä¾‹åŒ–"><a href="#å•ä¾‹çš„å®ä¾‹åŒ–" class="headerlink" title="å•ä¾‹çš„å®ä¾‹åŒ–"></a>å•ä¾‹çš„å®ä¾‹åŒ–</h1><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ç”Ÿæˆè¯¥å•ä¾‹èƒ½ï¼Œç”±äºå•ä¾‹æ˜¯å…¨å‰§å”¯ä¸€çš„ï¼Œæ ¹æ®è¿™ä¸ªç‰¹æ€§æˆ‘ä»¬ä¸€èˆ¬åœ¨ Application ä¸­å®ä¾‹åŒ–å®ƒ</p><pre><code class="java">public class App extends Application {    @Override    public void onCreate() {        super.onCreate();        if (!AppContext.isInitialized()){            AppContext.init(getApplicationContext());        }    }}</code></pre><hr><h1 id="å•ä¾‹-context-çš„ä½¿ç”¨"><a href="#å•ä¾‹-context-çš„ä½¿ç”¨" class="headerlink" title="å•ä¾‹ context çš„ä½¿ç”¨"></a>å•ä¾‹ context çš„ä½¿ç”¨</h1><p>context çš„ä½¿ç”¨å¯ä»¥è¯´éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚è·å¾—ç¨‹åºç½‘ç»œåŠŸèƒ½ï¼Œè·å¾—åˆ¶å®šæ§ä»¶å±æ€§ç­‰ç­‰ï¼Œç”¨é€”å¯ä»¥è¯´æ˜¯éå¸¸å¹¿æ³›</p><ul><li>è·å¾—ç½‘ç»œçŠ¶æ€</li></ul><pre><code class="java">NetworkUtil.isNetworkAvailable(AppContext.getInstance().getApplicationContext()public class NetworkUtil {    /**     * æ£€æŸ¥ç½‘ç»œæ˜¯å¦å¯ç”¨     *     * @param context     * @return     */    public static boolean isNetworkAvailable(Context context) {        ConnectivityManager manager = (ConnectivityManager) context                .getApplicationContext().getSystemService(                        Context.CONNECTIVITY_SERVICE);        if (manager == null) {            return false;        }        NetworkInfo networkinfo = manager.getActiveNetworkInfo();        if (networkinfo == null || !networkinfo.isAvailable()) {            return false;        }        return true;    }}</code></pre><ul><li>åœ¨å·¥å…·ç±»ä¸­è·å¾—æ§ä»¶å±æ€§å€¼</li></ul><pre><code class="java">    /**     * color.xmlé‡Œé¢çš„id     */    public static int getColor(int colorResId){        Context context = OrderContext.getInstance().getApplicationContext();        return context.getResources().getColor(colorResId);    }</code></pre><hr><p>å•ä¾‹æ¨¡å¼çš„ä½¿ç”¨éå¸¸å¹¿æ³›ï¼Œä½†å…·ä½“çš„å†…å®¹åŸºæœ¬å°±è¿™äº›ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯æˆ‘å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€ç‚¹æ€»ç»“ã€‚</p><p>å¤§å®¶å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸ŠåŠ ä»¥æ”¹é€ ä½¿ç”¨ï¼Œå¦‚æœæœ‰å…¶ä»–çš„åº”ç”¨åœºæ™¯ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸­åˆ†äº«ï¼Œä¸€èµ·è¿›æ­¥ï½ï¼</p>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å•ä¾‹æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é«˜æ•ˆè§£å†³ã€ŒSQLiteã€æ•°æ®åº“å¹¶å‘è®¿é—®å®‰å…¨é—®é¢˜ï¼Œåªè¿™ä¸€ç¯‡å°±å¤Ÿäº†</title>
    <link href="undefined2019/10/07/%E9%AB%98%E6%95%88%E8%A7%A3%E5%86%B3%E3%80%8CSQLite%E3%80%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%EF%BC%8C%E5%8F%AA%E8%BF%99%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86/"/>
    <url>2019/10/07/%E9%AB%98%E6%95%88%E8%A7%A3%E5%86%B3%E3%80%8CSQLite%E3%80%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%EF%BC%8C%E5%8F%AA%E8%BF%99%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86/</url>
    
    <content type="html"><![CDATA[<p><img src="https://user-gold-cdn.xitu.io/2019/9/29/16d7d4bb55a49eb6?w=2000&h=1215&f=jpeg&s=125618" srcset="/img/loading.gif" alt="å­¦Android"></p><h1 id="Concurrent-database-access"><a href="#Concurrent-database-access" class="headerlink" title="Concurrent database access"></a>Concurrent database access</h1><hr><p>å¯¹äº Android Dev è€Œè¨€ï¼Œæœ‰å…³ SQLite çš„æ“ä½œå†ç»å¸¸ä¸è¿‡äº†ï¼Œç›¸æ¯”ä½ ä¸€å®šç»å†è¿‡æ§åˆ¶å°ä¸€ç‰‡çˆ†çº¢çš„æƒ…å†µï¼Œè¿™ä¸ç¦è®©æˆ‘ä»¬ç–‘é—®ï¼šSQLite åˆ°åº•æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</p><p><strong>OK  åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ â¬‡ï¸</strong></p><h1 id="ç›´æ¥å¼€å§‹"><a href="#ç›´æ¥å¼€å§‹" class="headerlink" title="ç›´æ¥å¼€å§‹"></a>ç›´æ¥å¼€å§‹</h1><hr><h4 id="é¦–å…ˆï¼Œå‡è®¾ä½ å·²ç»å®ç°äº†ä¸€ä¸ª-SQLiteHelper-ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š"><a href="#é¦–å…ˆï¼Œå‡è®¾ä½ å·²ç»å®ç°äº†ä¸€ä¸ª-SQLiteHelper-ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š" class="headerlink" title="é¦–å…ˆï¼Œå‡è®¾ä½ å·²ç»å®ç°äº†ä¸€ä¸ª SQLiteHelper ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š"></a>é¦–å…ˆï¼Œå‡è®¾ä½ å·²ç»å®ç°äº†ä¸€ä¸ª SQLiteHelper ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</h4><pre><code class="java">public class DatabaseHelper extends SQLiteOpenHelper { ... }</code></pre><p>ç°åœ¨ä½ æƒ³è¦åœ¨ä¸¤ä¸ªå­çº¿ç¨‹ä¸­ï¼Œåˆ†åˆ«åœ°å‘ SQLite é‡Œå†™å…¥ä¸€äº›æ•°æ®ï¼š</p><pre><code class="java"> // Thread 1 Context context = getApplicationContext(); DatabaseHelper helper = new DatabaseHelper(context); SQLiteDatabase database = helper.getWritableDatabase(); database.insert(â€¦); database.close(); // Thread 2 Context context = getApplicationContext(); DatabaseHelper helper = new DatabaseHelper(context); SQLiteDatabase database = helper.getWritableDatabase(); database.insert(â€¦); database.close();</code></pre><blockquote><p>å¯¹å§ï¼Ÿçœ‹ä¸Šå»å¾ˆ OK æ²¡å•¥æ¯›ç—…ã€‚</p></blockquote><p>é‚£ä¹ˆè¿™æ—¶ï¼Œæˆ‘ä»¬ç‚¹ä¸€ä¸‹ <code>run</code> ï¼Œgioï½ ä½ å°†ä¼šåœ¨ä½ çš„ logcat é‡Œæ”¶åˆ°å¦‚ä¸‹ç¤¼ç‰©ã€ŒæŠ¥é”™ã€ï¼š</p><pre><code class="java">android.database.sqlite.SQLiteDatabaseLockedException: database is locked (code 5)</code></pre><h4 id="åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ"><a href="#åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ" class="headerlink" title="åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ"></a>åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</h4><p>æˆ‘ä»¬åˆ†æä¸€ä¸‹æŠ¥é”™ç»ˆäºå‘ç°ï¼šè¿™æ˜¯ç”±äºä½ æ¯æ¬¡åˆ›å»º SQLiteHelper æ—¶ï¼Œéƒ½å¯¹æ•°æ®åº“è¿›è¡Œäº†ä¸€ä¸ªé“¾æ¥æ“ä½œã€‚è¿™æ—¶ï¼Œå¦‚æœä½ å°è¯•ç€ï¼ŒåŒæ—¶ä»å®é™…ä¸åŒçš„é“¾æ¥ä¸­ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œå†™å…¥æ“ä½œï¼Œå¤±è´¥å°±æ˜¯å¿…ç„¶çš„äº†ã€‚</p><blockquote><p><strong>æ€»ç»“ä¸€ä¸‹</strong><br>å¦‚æœæˆ‘ä»¬æƒ³å†ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œå¯¹æ•°æ®åº“è¿›è¡ŒåŒ…æ‹¬è¯»å†™æ“ä½œåœ¨å†…çš„ä»»ä½•ä½¿ç”¨ï¼Œæˆ‘ä»¬å°±å¿…é¡»å¾—ç¡®ä¿ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªçš„è¿æ¥</p></blockquote><p>å¥½ï¼Œé‚£ç°åœ¨é—®é¢˜å°±æ˜äº†äº†ã€‚ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•ä¾‹æ¨¡å¼ç±»ï¼š<code>DatabaseManager</code> ç”¨æ¥åˆ›å»ºå’Œè¿”å›å”¯ä¸€çš„ï¼Œå•ä¾‹ <code>DatabaseManager</code> å¯¹è±¡ã€‚</p><blockquote><p>ps æœ‰äº›åŒå­¦é—®æˆ‘ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Œæˆ‘ä¸“é—¨è·‘å»å†™äº†è¿™ç¯‡åšå®¢æ¥è§£é‡Šä¸‹ï¼Œ<a href="https://blog.csdn.net/qq_43377749/article/details/96324909" target="_blank" rel="noopener">å•ä¾‹æ¨¡å¼-å…¨å±€å¯ç”¨çš„ context å¯¹è±¡ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a>ç å­—ä¸æ˜“å¸®æˆ‘ç‚¹ä¸ªèµè°¢è°¢ ğŸ™</p></blockquote><pre><code class="java">public class DatabaseManager {    private static DatabaseManager instance;    private static SQLiteOpenHelper mDatabaseHelper;    public static synchronized void initializeInstance(SQLiteOpenHelper helper) {        if (instance == null) {            instance = new DatabaseManager();            mDatabaseHelper = helper;        }    }    public static synchronized DatabaseManager getInstance() {        if (instance == null) {            throw new IllegalStateException(DatabaseManager.class.getSimpleName() +                    &quot; is not initialized, call initialize(..) method first.&quot;);        }        return instance;    }    public synchronized SQLiteDatabase getDatabase() {        return mDatabaseHelper.getWritableDatabase();    }}</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨å›æ¥ä¿®æ”¹ä¸‹ä¹‹å‰çš„ä»£ç ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class="java">// In your application classDatabaseManager.initializeInstance(new DatabaseHelper());// Thread 1DatabaseManager manager = DatabaseManager.getInstance();SQLiteDatabase database = manager.getDatabase()database.insert(â€¦);database.close();// Thread 2DatabaseManager manager = DatabaseManager.getInstance();SQLiteDatabase database = manager.getDatabase()database.insert(â€¦);database.close();</code></pre><p>é€»è¾‘æ¯”ä¹‹å‰æ›´æ¸…æ™°ï¼Œä»£ç å†—ä½™ä¹Ÿå°‘äº†ã€‚ç°åœ¨æˆ‘ä»¬åœ¨è·‘ä¸‹ä»£ç ï¼Œè¿™æ—¶æˆ‘ä»¬ä¼šæ”¶åˆ°ï¼Œå¦ä¸€ä¸ª <code>cache</code> ï¼š</p><pre><code class="java">java.lang.IllegalStateException: attempt to re-open an already-closed object: SQLiteDatabase</code></pre><p>ä¸è¦æ…Œï¼Œæˆ‘ä»¬ä»”ç»†åˆ†æä¸‹æŠ¥é”™ï¼Œæˆ‘ä»¬å‘ç°ï¼šå•ä¾‹æ¨¡å¼çš„ä½¿ç”¨ä¿è¯äº†æˆ‘ä»¬ï¼Œåœ¨çº¿ç¨‹ä¸€ã€äºŒã€ŒThread 1ã€Thread 2 ä¸­ã€åªä¼šè·å¾—åˆ°å”¯ä¸€çš„ SQLiteHelper å¯¹è±¡ï¼Œä½†è¿™æ—¶é—®é¢˜å°±æ¥äº†ï¼Œå½“æˆ‘ä»¬è¿è¡Œå®Œçº¿ç¨‹ä¸€ã€ŒThread 1ã€æ—¶ï¼Œæˆ‘ä»¬çš„ <code>database.close();</code> å·²ç»æ›¿æˆ‘ä»¬å…³é—­äº†å¯¹æ•°æ®åº“çš„è¿æ¥ï¼Œä½†ä¸æ­¤åŒæ—¶æˆ‘ä»¬çš„çº¿ç¨‹äºŒã€ŒThread 2ã€ä¾ç„¶ä¿æŒè¿™å¯¹ SQLiteHelper çš„å¼•ç”¨ã€‚æ­£æ˜¯è¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬æ”¶åˆ°äº†<code>IllegalStateException</code>çš„æŠ¥é”™ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ä¿è¯ï¼Œå½“æ²¡æœ‰äººä½¿ç”¨ SQLiteHelper æ—¶ï¼Œå†å°†å…¶æ–­å¼€è¿æ¥ã€‚</p><h4 id="ä¿è¯-SQLIiteHelper-åœ¨æ— äººä½¿ç”¨æ—¶æ‰æ–­å¼€è¿æ¥"><a href="#ä¿è¯-SQLIiteHelper-åœ¨æ— äººä½¿ç”¨æ—¶æ‰æ–­å¼€è¿æ¥" class="headerlink" title="ä¿è¯ SQLIiteHelper åœ¨æ— äººä½¿ç”¨æ—¶æ‰æ–­å¼€è¿æ¥"></a>ä¿è¯ SQLIiteHelper åœ¨æ— äººä½¿ç”¨æ—¶æ‰æ–­å¼€è¿æ¥</h4><p>å…³äºè¿™ä¸ªé—®é¢˜çš„è§£å†³ stackoveflow ä¸Šå¾ˆå¤šäººå»ºè®®æˆ‘ä»¬ï¼šæ°¸è¿œä¸è¦æ–­å¼€ SQLiteHelper çš„è¿æ¥ï¼Œä½†æ˜¯è¿™æ ·ä»¥æ¥ä½ ä¼šåœ¨ logcat ä¸Šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><pre><code class="java">Leak foundCaused by: java.lang.IllegalStateException: SQLiteDatabase created and never closed</code></pre><p>æ‰€ä»¥ï¼Œæˆ‘éå¸¸ä¸å»ºè®®ä½ ç”¨è¿™ä¸ªæ–¹æ³•ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥è®¡æ•°å™¨çš„æ¦‚å¿µ</p><h4 id="æ ‡å‡†æ ·ä¾‹"><a href="#æ ‡å‡†æ ·ä¾‹" class="headerlink" title="æ ‡å‡†æ ·ä¾‹"></a>æ ‡å‡†æ ·ä¾‹</h4><p>é€šè¿‡å¦‚ä¸‹æ–¹æ³•ï¼Œä½ å°†é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨æ¥å®Œç¾è§£å†³ æ‰“å¼€/å…³é—­ æ•°æ®åº“è¿æ¥çš„é—®é¢˜ï¼š</p><pre><code class="java">public class DatabaseManager {    private AtomicInteger mOpenCounter = new AtomicInteger();    private static DatabaseManager instance;    private static SQLiteOpenHelper mDatabaseHelper;    private SQLiteDatabase mDatabase;    public static synchronized void initializeInstance(SQLiteOpenHelper helper) {        if (instance == null) {            instance = new DatabaseManager();            mDatabaseHelper = helper;        }    }    public static synchronized DatabaseManager getInstance() {        if (instance == null) {            throw new IllegalStateException(DatabaseManager.class.getSimpleName() +                    &quot; is not initialized, call initializeInstance(..) method first.&quot;);        }        return instance;    }    public synchronized SQLiteDatabase openDatabase() {        if(mOpenCounter.incrementAndGet() == 1) {            // Opening new database            mDatabase = mDatabaseHelper.getWritableDatabase();        }        return mDatabase;    }    public synchronized void closeDatabase() {        if(mOpenCounter.decrementAndGet() == 0) {            // Closing database            mDatabase.close();        }    }}</code></pre><p>æˆ‘ä»¬åœ¨çº¿ç¨‹ä¸­å¯ä»¥è¿™æ ·ä½¿ç”¨å®ƒï¼š</p><pre><code class="java">SQLiteDatabase database = DatabaseManager.getInstance().openDatabase();database.insert(...);// database.close(); Don&#39;t close it directly!DatabaseManager.getInstance().closeDatabase(); // correct way</code></pre><p>æ¯å½“ä½ éœ€è¦ä½¿ç”¨æ•°æ®åº“æ—¶ï¼Œä½ åªè¦è°ƒç”¨ DatabaseManager ä¸­çš„ openDatabase() æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªï¼Œç”¨æ¥è®°å½•æ•°æ®åº“è¢«â€œæ‰“å¼€â€äº†å‡ æ¬¡çš„ mOpenCounter å¯¹è±¡ã€‚å½“å®ƒç­‰äº 1 æ—¶ï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦å»åˆ›å»ºæ–°çš„æ•°æ®åº“è¿æ¥æ¥ä½¿ç”¨æ•°æ®åº“ï¼Œå¦åˆ™çš„è¯ï¼Œå°±è¯´æ˜æ•°æ®åº“å·²ç»åœ¨ä½¿ç”¨ä¸­äº†ã€‚</p><p>åŒæ ·çš„æƒ…å†µä¹Ÿå‘ç”Ÿåœ¨ closeDatabase() æ–¹æ³•ä¸­ï¼Œå½“ä½ æ¯æ¬¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬çš„ mOpenCounter å¯¹è±¡å°±ä¼šå‡ä¸€ã€‚å½“å®ƒå‡åˆ° 0 æ—¶ï¼Œæˆ‘ä»¬å°±å»å…³é—­è¿™ä¸ªæ•°æ®åº“çš„è¿æ¥ã€‚</p><p>å®Œç¾ï¼Œæœ€åï¼š</p><ol><li>ç°åœ¨ä½ å°±èƒ½éšå¿ƒæ‰€æ¬²çš„ä½¿ç”¨ä½ çš„æ•°æ®åº“ï¼Œè€Œä¸”ä½ å¯ä»¥ç›¸ä¿¡ â€“ å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„äº†ï¼</li><li>å½“ç„¶å¾ˆå¤šåŒå­¦å¯¹æ•°æ®åº“çš„ä½¿ç”¨ï¼Œè¿˜æœ‰ç€å¾ˆå¤šçš„ç–‘æƒ‘ï¼Œæˆ‘åæœŸå°†ä¼šé’ˆå¯¹æ•°æ®åº“çš„ä½¿ç”¨ï¼Œä½œå‡ºä¸€ç³»åˆ—æ€»ç»“ï¼Œæœ‰å…´è¶£å¯ä»¥ç»§ç»­å…³æ³¨ <strong><a href="https://juejin.im/user/5d00b2ee6fb9a07ef5622eed/posts" target="_blank" rel="noopener">_yuanhao çš„ç¼–ç¨‹ä¸–ç•Œ</a></strong></li></ol><h1 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " class="headerlink" title="ç›¸å…³æ–‡ç« "></a>ç›¸å…³æ–‡ç« </h1><hr><blockquote><h4 id="æ¯ä¸ªäººéƒ½è¦å­¦çš„å›¾ç‰‡å‹ç¼©ï¼Œæœ‰æ•ˆè§£å†³-Android-ç¨‹åº-OOM"><a href="#æ¯ä¸ªäººéƒ½è¦å­¦çš„å›¾ç‰‡å‹ç¼©ï¼Œæœ‰æ•ˆè§£å†³-Android-ç¨‹åº-OOM" class="headerlink" title="æ¯ä¸ªäººéƒ½è¦å­¦çš„å›¾ç‰‡å‹ç¼©ï¼Œæœ‰æ•ˆè§£å†³ Android ç¨‹åº OOM"></a><a href="https://juejin.im/post/5d932934e51d45784f2503a7" target="_blank" rel="noopener">æ¯ä¸ªäººéƒ½è¦å­¦çš„å›¾ç‰‡å‹ç¼©ï¼Œæœ‰æ•ˆè§£å†³ Android ç¨‹åº OOM</a></h4><h4 id="Android-è®©ä½ çš„-Room-æ­ä¸Š-RxJava-çš„é¡ºé£è½¦-ä»é‡å¤çš„ä»£ç ä¸­è§£è„±å‡ºæ¥"><a href="#Android-è®©ä½ çš„-Room-æ­ä¸Š-RxJava-çš„é¡ºé£è½¦-ä»é‡å¤çš„ä»£ç ä¸­è§£è„±å‡ºæ¥" class="headerlink" title="Android è®©ä½ çš„ Room æ­ä¸Š RxJava çš„é¡ºé£è½¦ ä»é‡å¤çš„ä»£ç ä¸­è§£è„±å‡ºæ¥"></a><a href="https://juejin.im/post/5d8ab439e51d45784021e446" target="_blank" rel="noopener">Android è®©ä½ çš„ Room æ­ä¸Š RxJava çš„é¡ºé£è½¦ ä»é‡å¤çš„ä»£ç ä¸­è§£è„±å‡ºæ¥</a></h4><h4 id="ViewModel-å’Œ-ViewModelProvider-Factoryï¼šViewModel-çš„åˆ›å»ºè€…"><a href="#ViewModel-å’Œ-ViewModelProvider-Factoryï¼šViewModel-çš„åˆ›å»ºè€…" class="headerlink" title="ViewModel å’Œ ViewModelProvider.Factoryï¼šViewModel çš„åˆ›å»ºè€…"></a><a href="https://juejin.im/post/5d80920bf265da03b638e0bd" target="_blank" rel="noopener">ViewModel å’Œ ViewModelProvider.Factoryï¼šViewModel çš„åˆ›å»ºè€…</a></h4><h4 id="å•ä¾‹æ¨¡å¼-å…¨å±€å¯ç”¨çš„-context-å¯¹è±¡ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†"><a href="#å•ä¾‹æ¨¡å¼-å…¨å±€å¯ç”¨çš„-context-å¯¹è±¡ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†" class="headerlink" title="å•ä¾‹æ¨¡å¼-å…¨å±€å¯ç”¨çš„ context å¯¹è±¡ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†"></a><a href="https://juejin.im/post/5d2ef3c96fb9a07ef90ccf90" target="_blank" rel="noopener">å•ä¾‹æ¨¡å¼-å…¨å±€å¯ç”¨çš„ context å¯¹è±¡ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></h4><h4 id="ç¼©æ”¾æ‰‹åŠ¿-ScaleGestureDetector-æºç è§£æï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†"><a href="#ç¼©æ”¾æ‰‹åŠ¿-ScaleGestureDetector-æºç è§£æï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†" class="headerlink" title="ç¼©æ”¾æ‰‹åŠ¿ ScaleGestureDetector æºç è§£æï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†"></a><a href="https://juejin.im/post/5d14cc0ff265da1b6d403750" target="_blank" rel="noopener">ç¼©æ”¾æ‰‹åŠ¿ ScaleGestureDetector æºç è§£æï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></h4><h4 id="Android-å±æ€§åŠ¨ç”»æ¡†æ¶-ObjectAnimatorã€ValueAnimator-ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†"><a href="#Android-å±æ€§åŠ¨ç”»æ¡†æ¶-ObjectAnimatorã€ValueAnimator-ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†" class="headerlink" title="Android å±æ€§åŠ¨ç”»æ¡†æ¶ ObjectAnimatorã€ValueAnimator ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†"></a><a href="https://juejin.im/post/5d09990bf265da1bd260ef52" target="_blank" rel="noopener">Android å±æ€§åŠ¨ç”»æ¡†æ¶ ObjectAnimatorã€ValueAnimator ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></h4><h4 id="çœ‹å®Œè¿™ç¯‡å†ä¸ä¼š-View-çš„åŠ¨ç”»æ¡†æ¶ï¼Œæˆ‘è·ªæ“è¡£æ¿"><a href="#çœ‹å®Œè¿™ç¯‡å†ä¸ä¼š-View-çš„åŠ¨ç”»æ¡†æ¶ï¼Œæˆ‘è·ªæ“è¡£æ¿" class="headerlink" title="çœ‹å®Œè¿™ç¯‡å†ä¸ä¼š View çš„åŠ¨ç”»æ¡†æ¶ï¼Œæˆ‘è·ªæ“è¡£æ¿"></a><a href="https://juejin.im/post/5d04610be51d45775a700309" target="_blank" rel="noopener">çœ‹å®Œè¿™ç¯‡å†ä¸ä¼š View çš„åŠ¨ç”»æ¡†æ¶ï¼Œæˆ‘è·ªæ“è¡£æ¿</a></h4><h4 id="Android-è‡ªå®šä¹‰æ—¶é’Ÿæ§ä»¶-æ—¶é’ˆã€åˆ†é’ˆã€ç§’é’ˆçš„ç»˜åˆ¶è¿™ä¸€ç¯‡å°±å¤Ÿäº†"><a href="#Android-è‡ªå®šä¹‰æ—¶é’Ÿæ§ä»¶-æ—¶é’ˆã€åˆ†é’ˆã€ç§’é’ˆçš„ç»˜åˆ¶è¿™ä¸€ç¯‡å°±å¤Ÿäº†" class="headerlink" title="Android è‡ªå®šä¹‰æ—¶é’Ÿæ§ä»¶ æ—¶é’ˆã€åˆ†é’ˆã€ç§’é’ˆçš„ç»˜åˆ¶è¿™ä¸€ç¯‡å°±å¤Ÿäº†"></a><a href="https://juejin.im/post/5d00f09c6fb9a07ef06f8d03" target="_blank" rel="noopener">Android è‡ªå®šä¹‰æ—¶é’Ÿæ§ä»¶ æ—¶é’ˆã€åˆ†é’ˆã€ç§’é’ˆçš„ç»˜åˆ¶è¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></h4><h4 id="android-è‡ªå®šä¹‰æ§ä»¶ä¹‹-ç»˜åˆ¶é’Ÿè¡¨ç›˜"><a href="#android-è‡ªå®šä¹‰æ§ä»¶ä¹‹-ç»˜åˆ¶é’Ÿè¡¨ç›˜" class="headerlink" title="android è‡ªå®šä¹‰æ§ä»¶ä¹‹-ç»˜åˆ¶é’Ÿè¡¨ç›˜"></a><a href="https://juejin.im/post/5d0c8faa5188253274727dc0" target="_blank" rel="noopener">android è‡ªå®šä¹‰æ§ä»¶ä¹‹-ç»˜åˆ¶é’Ÿè¡¨ç›˜</a></h4><h4 id="Android-è¿›é˜¶è‡ªå®šä¹‰-ViewGroup-è‡ªå®šä¹‰å¸ƒå±€"><a href="#Android-è¿›é˜¶è‡ªå®šä¹‰-ViewGroup-è‡ªå®šä¹‰å¸ƒå±€" class="headerlink" title="Android è¿›é˜¶è‡ªå®šä¹‰ ViewGroup è‡ªå®šä¹‰å¸ƒå±€"></a><a href="https://juejin.im/post/5d0db01af265da1bcc194aba" target="_blank" rel="noopener">Android è¿›é˜¶è‡ªå®šä¹‰ ViewGroup è‡ªå®šä¹‰å¸ƒå±€</a></h4></blockquote><h1 id="æ¬¢è¿å…³æ³¨-yuanhaoçš„æ˜é‡‘ï¼"><a href="#æ¬¢è¿å…³æ³¨-yuanhaoçš„æ˜é‡‘ï¼" class="headerlink" title="æ¬¢è¿å…³æ³¨_yuanhaoçš„æ˜é‡‘ï¼"></a>æ¬¢è¿å…³æ³¨<a href="https://juejin.im/user/5d00b2ee6fb9a07ef5622eed/posts" target="_blank" rel="noopener">_yuanhao</a>çš„æ˜é‡‘ï¼</h1><hr><p>å®šæœŸåˆ†äº«<code>Androidå¼€å‘</code>æ¹¿è´§ï¼Œè¿½æ±‚æ–‡ç« <code>å¹½é»˜ä¸æ·±åº¦</code>çš„å®Œç¾ç»Ÿä¸€ã€‚</p><p>å…³äºæºç  Demo é“¾æ¥ï¼š<strong><a href="https://github.com/FishInWater-1999/SQLiteSample" target="_blank" rel="noopener">ä¸ºäº†å†™ Demo èŠ±äº†å¥½å‡ å¤©æ—¶é—´ï¼Œå¸Œæœ›å¤§å®¶ç‚¹æ­Œ star~ è°¢è°¢ï¼</a></strong></p><h3 id="è¯·ç‚¹èµï¼å› ä¸ºä½ çš„é¼“åŠ±æ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼"><a href="#è¯·ç‚¹èµï¼å› ä¸ºä½ çš„é¼“åŠ±æ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼" class="headerlink" title="è¯·ç‚¹èµï¼å› ä¸ºä½ çš„é¼“åŠ±æ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼"></a>è¯·ç‚¹èµï¼å› ä¸ºä½ çš„é¼“åŠ±æ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼</h3><p><img src="https://user-gold-cdn.xitu.io/2019/9/29/16d7d4cac8f48e62?w=2000&h=1215&f=jpeg&s=190057" srcset="/img/loading.gif" alt="å­¦Android"></p>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SQLite</tag>
      
      <tag>çº¿ç¨‹å®‰å…¨</tag>
      
      <tag>å¹¶å‘è®¿é—®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ViewModel å’Œ ViewModelProvider.Factoryï¼šViewModel çš„åˆ›å»ºè€…</title>
    <link href="undefined2019/10/06/ViewModel%20%E5%92%8C%20ViewModelProvider.Factory%EF%BC%9AViewModel%20%E7%9A%84%E5%88%9B%E5%BB%BA%E8%80%85/"/>
    <url>2019/10/06/ViewModel%20%E5%92%8C%20ViewModelProvider.Factory%EF%BC%9AViewModel%20%E7%9A%84%E5%88%9B%E5%BB%BA%E8%80%85/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img-blog.csdnimg.cn/20190915160822831.jpg" srcset="/img/loading.gif" alt></p><blockquote><p>æœ‹å‹ä»¬å¥½ï¼Œä»Šå¤©æˆ‘å‘å¤§å®¶ä»‹ç»ä¸‹ ViewModel ä¸­å¦‚ä½•ä½¿ç”¨ ViewModelProvider.Factory.</p></blockquote><hr><h1 id="ç°åœ¨å¼€å§‹"><a href="#ç°åœ¨å¼€å§‹" class="headerlink" title="ç°åœ¨å¼€å§‹"></a>ç°åœ¨å¼€å§‹</h1><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬é¦–è¦é—®é¢˜æ˜¯ï¼šä»€ä¹ˆæ˜¯ ViewModelProvider.Factory ?è®©æˆ‘ä»¬åœ¨ä¸ä½¿ç”¨ ViewModelProvider.Factory çš„æƒ…å†µä¸‹ï¼Œè¯•ç€åˆ›å»ºä¸€ä¸ª ViewModel çœ‹çœ‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190915160918134.png" srcset="/img/loading.gif" alt="MyViewModel.kt"></p><p>åœ¨æ´»åŠ¨ä¸­å®ä¾‹åŒ–ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190915161022293.png" srcset="/img/loading.gif" alt="MyActivity.kt"></p><p>æœ‰æ²¡æœ‰äººæ³¨æ„åˆ°ï¼šå½“æˆ‘ä»¬ä½¿ç”¨ ViewModelProviders åœ¨æ´»åŠ¨ä¸­å®ä¾‹åŒ– MyViewModel æ—¶ï¼Œä»æœªæ²¡ç”¨è¿‡ MyViewModel çš„æ„é€ æ–¹æ³•ï¼Œè€Œéƒ½æ˜¯ä½¿ç”¨ ViewModelProviders è¿™ä¸ªç±»ä¸­çš„æ–¹æ³•ã€‚ViewModelProviders åœ¨å†…éƒ¨ä¸ºæˆ‘ä»¬ç®¡ç†å¹¶è°ƒç”¨ ViewModel çš„ä¸»æ„é€ å‡½æ•°ï¼Œåˆ›å»ºviewmodelçš„å®ä¾‹å¹¶å°†è¯¥å®ä¾‹å¹¶è¿”å›ã€‚</p><p>é‚£ä¹ˆï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥æŠŠå‚æ•°ä¼ é€’ç»™ MyViewModel ç±»çš„æ„é€ æ–¹æ³•æ—¶ä¼šå‘ç”Ÿäº†ä»€ä¹ˆï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190915184848112.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMzc3NzQ5,size_16,color_FFFFFF,t_70" srcset="/img/loading.gif" alt="MyViewModel.kt"></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨æ´»åŠ¨ä¸­åˆ›å»º MyViewModel å®ä¾‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190915184940962.png" srcset="/img/loading.gif" alt="MyActivity.kt"></p><p>å¤ªæ£’äº†ï¼æ²¡æœ‰å‘ç”Ÿä»»ä½•é”™è¯¯</p><p>ä½†æ˜¯ï¼Œç­‰ç­‰ã€‚</p><p>å½“ä½ è¿è¡Œä¸Šé¢è¿™æ®µä»£ç çš„æ—¶å€™ï¼Œä½ æ”¶åˆ°äº† RunTimeErrorã€‚ç¨‹åºå´©æºƒäº†ï¼ï¼ï¼ RuntimeException ä¸èƒ½åˆ›å»ºå‡º MyViewModel å®ä¾‹ã€‚</p><p>ç°åœ¨æˆ‘ä»¬ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™äº›ã€‚ViewModelProviders çš„ of() æ–¹æ³•ï¼Œåœ¨å†…éƒ¨åˆ›å»ºäº†é»˜è®¤çš„ ViewModelProvider.Factory ï¼Œä»è€Œå®ç°äº† ViewModel çš„æ— å‚åˆ›å»ºã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬åœ¨æ„é€ æ–¹æ³•æ·»åŠ å‚æ•°æ—¶ï¼Œ ViewModelProvider.Factory çš„å†…éƒ¨æ— æ³•å®ä¾‹åŒ– ViewModel å¯¹è±¡ï¼Œå› ä¸º ViewModelProvider.Factory è°ƒç”¨ä¸»æ„é€ æ–¹æ³•åˆ›å»º ViewModelâ€™s å®ä¾‹è€Œå¤±è´¥ã€‚ä¸‹å›¾æ˜¯ ViewModelFactory ViewModelFactory çš„é»˜è®¤å®ç°ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20190915190507130.png" srcset="/img/loading.gif" alt="ViewModel Factory inner implementation"><br>å¦‚æœä½ æƒ³åœ¨æ„é€ æ–¹æ³•ä¸­æ·»åŠ å‚æ•°ï¼Œä½ éœ€è¦ç¼–å†™è‡ªå·±çš„ ViewModelProvider æ¥åˆ›å»º ViewModel å®ä¾‹ã€‚</p><h1 id="ä»€ä¹ˆæ˜¯-ViewModelProvider-Factory"><a href="#ä»€ä¹ˆæ˜¯-ViewModelProvider-Factory" class="headerlink" title="ä»€ä¹ˆæ˜¯ ViewModelProvider.Factory?"></a>ä»€ä¹ˆæ˜¯ ViewModelProvider.Factory?</h1><p>ViewModelProviders.Factory æ¥å£æ˜¯è´Ÿè´£å®ä¾‹åŒ– ViewModels å¯¹è±¡çš„å¯åŠ¨è£…ç½®ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦è‡ªå·±å†™å®ä¾‹åŒ– ViewModel å¯¹è±¡çš„æ–¹æ³•ã€‚</p><p>è®©æˆ‘ä»¬åƒä¸‹é¢è¿™æ ·åˆ›å»ºè‡ªå·±çš„ ViewModelProvider.Factory ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20190915192036556.png" srcset="/img/loading.gif" alt="MyViewModelFactory.kt"></p><p>è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦è®°ä¸‹ï¼š</p><ol><li>ä½ éœ€è¦é€šè¿‡æ„é€ æ–¹æ³•æˆ–è€…å…¶ä»–ä½ å–œæ¬¢çš„é€”å¾„ï¼ˆæ¯”å¦‚ Singleton, FactoryPattern ç­‰ç­‰ï¼‰ã€‚è¿™æ˜¯ç”±äºä½ åœ¨å®ä¾‹åŒ– ViewModel å¯¹è±¡æ—¶ï¼Œä¸èƒ½ç›´æ¥åœ¨æ´»åŠ¨æˆ–è€…ç¢ç‰‡ä¸­è°ƒç”¨ ViewModel çš„æ„é€ æ–¹æ³•ï¼Œè€Œä¸”ä½ åˆæƒ³å»è®¾ç½® ViewModel æ„é€ æ–¹æ³•çš„å‚æ•°ï¼Œå› æ­¤ä½ éœ€è¦å°†å‚æ•°ä¼ å…¥ ViewModelProvider.Factory å®ƒå°†ä¼šå¸®ä½ åˆ›å»ºä½ çš„ ViewModelã€‚</li><li>ViewModelProvider.Factory æ˜¯ä¸€ä¸ªåŒ…å« create æ–¹æ³•çš„æ¥å£ã€‚è¿™ä¸ª create æ–¹æ³•è´Ÿè´£åˆ›å»ºä½ çš„ VeiwModelâ€™s å®ä¾‹ã€‚</li><li>modelClass.getConstructor(Int::class.java) æ–¹æ³•æ˜¯ä¸€ä¸ªæ•´å‹çš„èƒ½å¤Ÿé€šè¿‡è°ƒç”¨ newInstance æ–¹æ³•æ¥æƒ³æ„é€ æ–¹æ³•ä¼ å€¼çš„æ–¹æ³•ã€‚</li></ol><p>ç°åœ¨å°±è®©æˆ‘ä»¬é€šè¿‡ ViewModelProvider.Factory åœ¨æ´»åŠ¨ä¸­åˆ›å»º ViewModel å®ä¾‹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20190915194318145.png" srcset="/img/loading.gif" alt="MyActivity.kt"></p><p>æˆ‘ä»¬å°†å‚æ•°æˆ–è€…ä¾èµ–å…³ç³»è½¬å…¥æˆ‘ä»¬çš„ ViewModelProvider.Factory ä»¥ä¾¿äºå®ƒèƒ½å¤Ÿä¸ºæˆ‘ä»¬åˆ›å»º ViewModelï¼ŒViewModelProviders.of( context, instanceOfViewModelFactory) æ–¹æ³•è·å¾—æˆ‘ä»¬ ViewModelProvider.Factory å®ä¾‹ï¼Œç°åœ¨å°±åƒä¹‹å‰çš„ä¾‹å­ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¼šäº†åˆ›å»º ViewModel å®ä¾‹çš„è¿‡ç¨‹ã€‚</p><h2 id="æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦-ViewModelProvider-Factory"><a href="#æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦-ViewModelProvider-Factory" class="headerlink" title="æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ ViewModelProvider.Factory ?"></a>æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ ViewModelProvider.Factory ?</h2><p>æˆ‘ä»¬å¿ƒä¸­æœ‰è¿™æ ·ä¸€äº›ç–‘é—®ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨æ´»åŠ¨æˆ–ç¢ç‰‡ä¸­å°†å€¼ä¼ å…¥ ViewModel æ„é€ æ–¹æ³•ä¸­å»ï¼Œæˆ‘éœ€è¦å†™æ³•æ¥è®¾ç½®æˆ‘ä»¬çš„å‚æ•°å€¼ä½¿å…¶æ­£å¸¸å·¥ä½œï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ ViewModelProver.Factoryï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹ä½ å¯ä»¥ä¸ä½¿ç”¨ï¼Œä½†åœ¨æŸäº›ç‰¹å®šæƒ…å½¢ä¸‹ï¼Œä½ éœ€è¦ä½¿ç”¨ ViewModelProver.Factoryã€‚</p><h2 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-ViewModelProvider-Factory"><a href="#ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-ViewModelProvider-Factory" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ ViewModelProvider.Factory"></a>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ ViewModelProvider.Factory</h2><p>å½“ä½ çš„ ViewModel æœ‰ä¾èµ–é¡¹ï¼Œå¹¶ä¸”ä½ éœ€è¦å°†è¿™äº›ä¾èµ–é¡¹é€šè¿‡æ„é€ æ–¹æ³•ä¼ å…¥ï¼Œå› æ­¤ï¼Œæ‚¨å¯ä»¥æ¨¡æ‹Ÿè¯¥ä¾èµ–é¡¹å¹¶æµ‹è¯• ViewModelã€‚</p><h2 id="ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨-ViewModelProvider-Factory"><a href="#ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨-ViewModelProvider-Factory" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨ ViewModelProvider.Factory"></a>ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨ ViewModelProvider.Factory</h2><p>å¦‚æœä½ çš„ ViewModel æ²¡æœ‰ä¾èµ–é¡¹ï¼Œè¿™æ—¶ä½ å°±ä¸éœ€è¦å»è‡ªå·±åˆ›å»º ViewModelProvider.Factoryã€‚ç³»ç»Ÿè‡ªå¸¦çš„æ–¹æ³•ï¼Œæ³¨æ„å¸®åŠ©ä½ åˆ›å»º ViewModelã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ViewModelProvider.Factory è´Ÿè´£å¸®ä½ åˆ›å»º ViewModel å®ä¾‹ã€‚å½“ä½ çš„ ViewModel å­˜åœ¨ä¾èµ–é¡¹ï¼Œä¸”ä½ å¸Œæœ›æµ‹è¯•ä½ çš„ ViewModel æ—¶ï¼Œä½ éœ€è¦åˆ›å»ºè‡ªå·±çš„ ViewModelProvider.Factory æ¥é€šè¿‡ ViewModel çš„æ„é€ æ–¹æ³•ä¼ é€’ä¾èµ–é¡¹ï¼Œå°†ä½ çš„æ•°å€¼ä¼ å…¥ ViewModelProvider.Factory å®ä¾‹ä¸­å»</p><blockquote><p>ä½ çš„å…³æ³¨æ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ViewModelProvider</tag>
      
      <tag>ViewModel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨ Mac ä¸Šå®‰è£… Git ï¼Œç”Ÿæˆ SSH å¯†é’¥ç”¨äº GitHub æˆæƒ</title>
    <link href="undefined2019/10/04/%E5%9C%A8-Mac-%E4%B8%8A%E5%AE%89%E8%A3%85-Git-%EF%BC%8C%E7%94%9F%E6%88%90-SSH-%E5%AF%86%E9%92%A5%E7%94%A8%E4%BA%8E-GitHub-%E6%8E%88%E6%9D%83/"/>
    <url>2019/10/04/%E5%9C%A8-Mac-%E4%B8%8A%E5%AE%89%E8%A3%85-Git-%EF%BC%8C%E7%94%9F%E6%88%90-SSH-%E5%AF%86%E9%92%A5%E7%94%A8%E4%BA%8E-GitHub-%E6%8E%88%E6%9D%83/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œå°†ä»‹ç»å¦‚ä½•åœ¨ Mac ä¸Šå®‰è£… Gitï¼Œå¦‚ä½•ç”ŸæˆSSHå¯†é’¥ï¼Œä»¥åŠå¦‚ä½•å°†æ‚¨çš„å…¬å…± SSH å¯†é’¥ä¸Šä¼ åˆ° GitHub å¸æˆ·è¿›è¡Œæˆæƒã€‚</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20190920090245710.png" srcset="/img/loading.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="å¦‚ä½•åœ¨ä½ çš„-Mac-ä¸Šå®‰è£…-Git-ï¼Ÿ"><a href="#å¦‚ä½•åœ¨ä½ çš„-Mac-ä¸Šå®‰è£…-Git-ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨ä½ çš„ Mac ä¸Šå®‰è£… Git ï¼Ÿ"></a>å¦‚ä½•åœ¨ä½ çš„ Mac ä¸Šå®‰è£… Git ï¼Ÿ</h1><p>æ‰“å¼€â€˜ç»ˆç«¯â€™è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code class="xml">$ brew install git</code></pre><blockquote><p> å…·ä½“æ–¹æ³•æŸ¥çœ‹å…¶å®˜æ–¹æ–‡æ¡£ ï¼š<a href="https://brew.sh/" target="_blank" rel="noopener">https://brew.sh/</a></p></blockquote><p>è¿™å°†åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šå®‰è£… Gitã€‚<br>è‹¥è¦ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸï¼Œè¯·è¾“å…¥ï¼š</p><pre><code class="xml">$ git --version</code></pre><p>è¿™æ ·ä½ å°±èƒ½çœ‹åˆ°ç›®å‰çš„ Git ç‰ˆæœ¬ã€‚</p><h1 id="å¦‚ä½•ä¸º-GitHub-æˆæƒç”Ÿæˆ-SSH-å¯†é’¥"><a href="#å¦‚ä½•ä¸º-GitHub-æˆæƒç”Ÿæˆ-SSH-å¯†é’¥" class="headerlink" title="å¦‚ä½•ä¸º GitHub æˆæƒç”Ÿæˆ SSH å¯†é’¥"></a>å¦‚ä½•ä¸º GitHub æˆæƒç”Ÿæˆ SSH å¯†é’¥</h1><h4 id="æ‰“å¼€ä½ çš„ç»ˆç«¯"><a href="#æ‰“å¼€ä½ çš„ç»ˆç«¯" class="headerlink" title="æ‰“å¼€ä½ çš„ç»ˆç«¯"></a>æ‰“å¼€ä½ çš„ç»ˆç«¯</h4><h4 id="è¾“å…¥-cd-æ¥åˆ°ä½ çš„æ ¹ç›®å½•ä¸‹"><a href="#è¾“å…¥-cd-æ¥åˆ°ä½ çš„æ ¹ç›®å½•ä¸‹" class="headerlink" title="è¾“å…¥  cd ~/  æ¥åˆ°ä½ çš„æ ¹ç›®å½•ä¸‹"></a>è¾“å…¥  <strong>cd ~/</strong>  æ¥åˆ°ä½ çš„æ ¹ç›®å½•ä¸‹</h4><h4 id="è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š"><a href="#è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š" class="headerlink" title="è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š"></a>è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š</h4><pre><code class="xml">ssh-keygen -t rsa</code></pre><ul><li>è¿™æ—¶ç³»ç»Ÿå°†æç¤ºæ‚¨è¾“å…¥ä¸€ä¸ªæ–‡ä»¶åæ¥å­˜å‚¨å¯†é’¥ </li><li>åªéœ€æŒ‰ â€˜å›è½¦â€™ æ¥å—é»˜è®¤æ–‡ä»¶ (/Users/you/.ssh/id_rsa) å³å¯</li><li>ç„¶åå®ƒä¼šè¦æ±‚æ‚¨åˆ›å»ºä¸€ä¸ªå¯†ç ã€‚ä½ å¯ä»¥è¿›è¡Œè®¾å®šï¼Œä½†æˆ‘ä¸€èˆ¬é€‰æ‹©ç›´æ¥å›è½¦ï¼ˆè¿™æ ·å¯†ç å°±ä¸ºç©ºï¼Œä¸ç”¨ä¸“é—¨å»è®°ï¼‰</li></ul><h4 id="å½“ä½ å†æ¬¡æŒ‰ä¸‹â€˜å›è½¦â€™æ—¶ï¼Œä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶å°±ä¼šè¢«å»ºç«‹äº†"><a href="#å½“ä½ å†æ¬¡æŒ‰ä¸‹â€˜å›è½¦â€™æ—¶ï¼Œä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶å°±ä¼šè¢«å»ºç«‹äº†" class="headerlink" title="å½“ä½ å†æ¬¡æŒ‰ä¸‹â€˜å›è½¦â€™æ—¶ï¼Œä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶å°±ä¼šè¢«å»ºç«‹äº†"></a>å½“ä½ å†æ¬¡æŒ‰ä¸‹â€˜å›è½¦â€™æ—¶ï¼Œä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶å°±ä¼šè¢«å»ºç«‹äº†</h4><pre><code class="xml">~/.ssh/id_rsa~/.ssh/id_rsa.pub</code></pre><h4 id="æœ€åä¸€æ­¥ï¼š"><a href="#æœ€åä¸€æ­¥ï¼š" class="headerlink" title="æœ€åä¸€æ­¥ï¼š"></a>æœ€åä¸€æ­¥ï¼š</h4><p>æˆ‘ä»¬éœ€è¦çš„ SSH å…¬é’¥å­˜å‚¨åœ¨ä»¥.pubç»“å°¾çš„æ–‡ä»¶ä¸­ï¼Œå³ï¼š<br><code>~/.ssh/id_rsa.pub</code></p><h1 id="å¦‚ä½•å¤åˆ¶å…¬å…±-SSH-å¯†é’¥"><a href="#å¦‚ä½•å¤åˆ¶å…¬å…±-SSH-å¯†é’¥" class="headerlink" title="å¦‚ä½•å¤åˆ¶å…¬å…± SSH å¯†é’¥"></a>å¦‚ä½•å¤åˆ¶å…¬å…± SSH å¯†é’¥</h1><p>ä¸ºäº†ä½¿ç”¨ GitHub éªŒè¯æ‚¨è‡ªå·±å’Œæ‚¨çš„è®¾å¤‡ï¼Œæ‚¨éœ€è¦å°†ä¸Šé¢ç”Ÿæˆçš„å…¬å…± SSHå¯†é’¥ ä¸Šä¼ åˆ°ä½ çš„ GitHub å¸æˆ·ã€‚</p><p><strong>å¤åˆ¶å…¬å…±SSHå¯†é’¥</strong></p><p>ä½ ä¸éœ€è¦å»å¯»æ‰¾è¿™ä¸ª .pub æ–‡ä»¶ï¼Œä½ åªéœ€è¦æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥ï¼š</p><pre><code class="xml">$ pbcopy &lt; ~/.ssh/id_rsa.pub</code></pre><p>è¿™å°†ç›´æ¥å¤åˆ¶ <code>id_rsa</code> æ–‡ä»¶å†…çš„å†…å®¹ã€‚</p><h1 id="å¦‚ä½•ä¸Šä¼ æ‚¨çš„å…¬å…±-SSH-å¯†é’¥åˆ°-GitHub"><a href="#å¦‚ä½•ä¸Šä¼ æ‚¨çš„å…¬å…±-SSH-å¯†é’¥åˆ°-GitHub" class="headerlink" title="å¦‚ä½•ä¸Šä¼ æ‚¨çš„å…¬å…± SSH å¯†é’¥åˆ° GitHub"></a>å¦‚ä½•ä¸Šä¼ æ‚¨çš„å…¬å…± SSH å¯†é’¥åˆ° GitHub</h1><ol><li>å¤åˆ¶äº†å…¬å…±SSHå¯†é’¥åï¼Œç™»å½•åˆ°GitHubå¸æˆ·å¹¶è½¬åˆ° <a href="https://github.com/settings/profile" target="_blank" rel="noopener">https://github.com/settings/profile</a></li><li>åœ¨å·¦ä¾§èœå•ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªé“¾æ¥â€œSSHå’ŒGPGå¯†é’¥â€</li><li>å•å‡»è¯¥é“¾æ¥ï¼Œå®ƒå°†å¸¦æ‚¨è¿›å…¥ä¸€ä¸ªé¡µé¢ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œè¾“å…¥æ‚¨ä¹‹å‰å¤åˆ¶çš„å…¬å…±SSHå¯†é’¥ã€‚</li><li>ç‚¹å‡»â€œæ–°å»ºSSHå¯†é’¥â€æŒ‰é’®</li><li>ç„¶åè¾“å…¥ä¸€ä¸ªæ ‡é¢˜åç§°â€”â€”å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œä¾‹å¦‚ newMac</li><li>å°†å…¬å…±SSHå¯†é’¥ç²˜è´´åˆ°å¯†é’¥æ–‡æœ¬æ¡†ä¸­</li><li>ç‚¹å‡»â€œæ·»åŠ SSHå¯†é’¥â€</li></ol><h1 id="å¤§åŠŸå‘Šæˆï¼æµ‹è¯•ä½ çš„GitHubæˆæƒ"><a href="#å¤§åŠŸå‘Šæˆï¼æµ‹è¯•ä½ çš„GitHubæˆæƒ" class="headerlink" title="å¤§åŠŸå‘Šæˆï¼æµ‹è¯•ä½ çš„GitHubæˆæƒ:"></a>å¤§åŠŸå‘Šæˆï¼æµ‹è¯•ä½ çš„GitHubæˆæƒ:</h1><p>æ‰“å¼€ä½ çš„ç»ˆç«¯è¾“å…¥</p><pre><code class="xml">$ git clone git@github.com:ä½ çš„ç”¨æˆ·å/ä½ çš„æŸä¸ªä»“åº“å.git</code></pre><ol><li>å®ƒä¼šé—®ä½ æ˜¯å¦æƒ³ç»§ç»­è¿æ¥ï¼Œè¾“å…¥ <code>yes</code></li><li>å¦‚æœæ‚¨åœ¨ç”Ÿæˆå…¬é’¥æ—¶åˆ›å»ºäº†ä¸€ä¸ªå¯†ç ï¼Œé‚£ä¹ˆå®ƒå°†è¦æ±‚æ‚¨è¾“å…¥å®ƒã€‚</li><li>è¾“å…¥å¯†ç å¹¶æŒ‰<code>Enter</code>é”®ã€‚</li><li>ç„¶åï¼Œå®ƒå°†å¼€å§‹å°†é¡¹ç›®å…‹éš†åˆ°æ‚¨å½“å‰çš„ç›®å½•ä¸­ã€‚</li></ol><p><strong>ç°åœ¨ï¼Œæ‚¨å·²ç»å‡†å¤‡å¥½ä½¿ç”¨Gitå’ŒGitHubäº†ã€‚æœ‰é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€</strong></p><blockquote><p>æ¬¢è¿å…³æ³¨æˆ‘çš„åšå®¢è·å¾—æ›´å¤šçŸ¥è¯†</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mac</tag>
      
      <tag>SSH</tag>
      
      <tag>GitHub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¯ä¸ªäººéƒ½è¦å­¦çš„å›¾ç‰‡å‹ç¼©ç»ˆæå¥¥ä¹‰ï¼Œæœ‰æ•ˆè§£å†³ Android ç¨‹åº OOM</title>
    <link href="undefined2019/10/03/%E6%AF%8F%E4%B8%AA%E4%BA%BA%E9%83%BD%E8%A6%81%E5%AD%A6%E7%9A%84%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%E7%BB%88%E6%9E%81%E5%A5%A5%E4%B9%89%EF%BC%8C%E6%9C%89%E6%95%88%E8%A7%A3%E5%86%B3%20Android%20%E7%A8%8B%E5%BA%8F%20OOM/"/>
    <url>2019/10/03/%E6%AF%8F%E4%B8%AA%E4%BA%BA%E9%83%BD%E8%A6%81%E5%AD%A6%E7%9A%84%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%E7%BB%88%E6%9E%81%E5%A5%A5%E4%B9%89%EF%BC%8C%E6%9C%89%E6%95%88%E8%A7%A3%E5%86%B3%20Android%20%E7%A8%8B%E5%BA%8F%20OOM/</url>
    
    <content type="html"><![CDATA[<h1 id="ç”±æ¥"><a href="#ç”±æ¥" class="headerlink" title="ç”±æ¥"></a>ç”±æ¥</h1><hr><blockquote><p>åœ¨æˆ‘ä»¬ç¼–å†™ <code>Android</code> ç¨‹åºçš„æ—¶å€™ï¼Œå‡ ä¹æ°¸è¿œé€ƒé¿ä¸äº†å›¾ç‰‡å‹ç¼©çš„éš¾é¢˜ã€‚é™¤äº†åº”ç”¨å›¾æ ‡ä¹‹å¤–ï¼Œæˆ‘ä»¬æ‰€è¦æ˜¾ç¤ºçš„å›¾ç‰‡åŸºæœ¬ä¸Šåªæœ‰ä¸¤ä¸ªæ¥æºï¼š</p><ul><li>æ¥è‡ªç½‘ç»œä¸‹è½½</li><li>æœ¬åœ°ç›¸å†Œä¸­åŠ è½½</li></ul></blockquote><p>ä¸ç®¡æ˜¯ç½‘ä¸Šä¸‹è½½ä¸‹æ¥çš„ä¹Ÿå¥½ï¼Œè¿˜æ˜¯ä»ç³»ç»Ÿå›¾ç‰‡åº“ä¸­è¯»å–çš„å›¾ç‰‡ï¼Œéƒ½æœ‰ä¸€ä¸ªç›¸åŒçš„ç‰¹ç‚¹ï¼šåƒç´ ä¸€å¸®è¾ƒé«˜ã€‚åŒæ—¶æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ<code>Android</code> ç³»ç»Ÿåˆ†é…ç»™æˆ‘ä»¬æ¯ä¸ªåº”ç”¨çš„å†…å­˜æ˜¯æœ‰é™çš„ï¼Œç”±äºè§£æã€åŠ è½½ä¸€å¼ å›¾ç‰‡ï¼Œéœ€è¦å ç”¨çš„å†…å­˜å¤§å°ï¼Œæ˜¯è¿œå¤§äºå›¾ç‰‡è‡ªèº«å¤§å°çš„ã€‚æ‰€ä»¥ï¼Œè¿™æ—¶ç¨‹åºå°±å¯èƒ½å› ä¸ºå ç”¨äº†è¿‡å¤šçš„å†…å­˜ï¼Œä»è€Œå‡ºç°<code>OOM</code> ç°è±¡ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯ <code>OOM</code> å‘¢ï¼Ÿ</p><p><code>OOM</code> å³ <code>OutOfMemory</code> å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ å†…å­˜æº¢å‡º ï¼Œå…¶ä¸€èˆ¬è¡¨ç°ä¸ºåº”ç”¨é—ªé€€ç­‰ç°è±¡ã€‚é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•ä¸‹æ‰‹å»è§£å†³å‘¢ï¼Ÿ</p><h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><hr><p>é¦–å…ˆæˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬æ‰€åŠ è½½çš„è¿™äº›å›¾ç‰‡çš„åˆ†è¾¨ç‡ï¼Œè¦æ¯”æˆ‘ä»¬æ‰‹æœºå±å¹•é«˜å¾—å¤šï¼Œæ›´æœ‰ç”šè€…ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªæ‹‡æŒ‡å¤§çš„æ§ä»¶ä¸Šï¼Œå»åŠ è½½ä¸€ä¸ª 4k å¤§å›¾æ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬èƒ½è®©æ¯ä¸ªæ§ä»¶ä¸Šéƒ½å»æ˜¾ç¤ºç›¸åº”å¤§å°çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜ä¹Ÿå°±è¿åˆƒè€Œè§£äº†</p><p>é‚£ä¹ˆï¼Œè¦æ€æ ·æ‰èƒ½è¾¾åˆ°å›¾ç‰‡ä¸æ§ä»¶çš„å¯¹å·å…¥åº§ï¼Ÿè¿™æ—¶æˆ‘ä»¬å°±å¼•è¿›äº†å›¾ç‰‡å‹ç¼©çš„æ–¹æ¡ˆï¼š</p><ul><li>é¦–å…ˆï¼Œè·å¾—åŸå›¾ç‰‡å¤§å°</li><li>å…¶æ¬¡ï¼Œè·å–æ§ä»¶å¤§å°</li><li>æ¥ç€ï¼Œè·å–æˆ‘ä»¬å›¾ç‰‡å’Œæ§ä»¶çš„æ¯”ä¾‹</li><li>æœ€åï¼Œæ ¹æ®è¿™ä¸€æ¯”ä¾‹ï¼Œå°†å›¾ç‰‡å‹ç¼©ä¸ºé€‚åˆæ˜¾ç¤ºçš„å¤§å°</li></ul><p>é‚£ä¹ˆå°±è®©æˆ‘ä»¬å¼€å§‹å§ï¼š</p><h1 id="è·å–åŸå›¾å¤§å°"><a href="#è·å–åŸå›¾å¤§å°" class="headerlink" title="è·å–åŸå›¾å¤§å°"></a>è·å–åŸå›¾å¤§å°</h1><hr><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ<code>Android å‘æˆ‘ä»¬æä¾›äº† BitmapFactory</code> è¿™ä¸ªç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­æœ‰ç€è¯¸å¦‚ï¼š<code>decodeResource()</code>  <code>decodeFile()</code>   <code>decodeStream()</code> ç­‰ã€‚å…¶ä¸­ï¼š</p><ul><li>decodeResource()  ï¼š    ç”¨äºè§£æèµ„æºæ–‡ä»¶ï¼Œå³ res æ–‡ä»¶å¤¹ä¸‹çš„å›¾ç‰‡</li><li>decodeFile() ï¼š               ç”¨äºè§£æç³»ç»Ÿç›¸å†Œä¸­çš„å›¾ç‰‡  </li><li>decodeStream() ï¼š        ç”¨äºè§£æè¾“å…¥è¾“å‡ºæµä¸­å›¾ç‰‡é€šå¸¸ï¼Œæ˜¯é‡‡ç”¨ HttpClient ä»ä¸‹è½½çš„å›¾ç‰‡</li></ul><p>å…¶ä»–çš„æ–¹æ³•è¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œå› ä¸ºåœ¨æºç ä¸­æˆ‘ä»¬å¯æœ‰içœ‹åˆ°ï¼Œå‡ ä¹æ‰€æœ‰çš„æ–¹æ³•ï¼Œæœ€åéƒ½ä¼šå°†å›¾ç‰‡è§£æä¸ºæµçš„å½¢å¼ï¼Œæœ€åè°ƒç”¨ <code>decodeStream()</code> æ–¹æ³•ï¼Œå®ä¾‹åŒ–å‡ºæˆ‘ä»¬çš„ <code>Bitmap</code> å¯¹è±¡ã€‚</p><p>è™½ç„¶è¿™äº›æ–¹æ³•å¯¹æˆ‘ä»¬æ˜¯å†ç†Ÿæ‚‰ä¸è¿‡çš„äº†ï¼Œä½†å¯¹äºæŸäº›åˆå­¦è€…è€Œè¨€ï¼Œå´ç»å¸¸å¿½ç•¥äº†ä¸€ä¸ªé‡è¦çš„å†…éƒ¨ç±» ï¼š<code>BitmapFactory.Options</code> ï¼Œç„¶è€Œä»–ç¡®å®æˆ‘ä»¬å›¾ç‰‡å‹ç¼©å¿…ä¸å¯å°‘çš„ï¼Œä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå‚æ•°å‘¢ï¼Ÿ<code>Options</code> çš„å¯¹è±¡ç”¨äºç¡®å®šéœ€è¦ç”Ÿæˆçš„ Bitmap å³ç›®æ ‡å›¾ç‰‡çš„å‚æ•°ã€‚<br>ä»–çš„ç”¨æ³•å¾ˆç®€å•ï¼Œæˆ‘ä»¬å…ˆ new ä¸€ä¸ª <code>BitmapFactory.Options</code> å¯¹è±¡ã€‚å†å»è°ƒç”¨å«æœ‰ <code>Options</code> å‚æ•°çš„æ–¹æ³•ï¼Œå¦‚</p><ul><li><code>public static Bitmap decodeResource(Resources res, int id, Options opts)</code></li><li><code>public static Bitmap decodeResourceStream(@Nullable Resources res,@Nullable TypedValue value,@Nullable InputStream is, @Nullable Rect pad, @Nullable Options opts)</code></li></ul><p>è°ƒç”¨å®Œä¹‹åæˆ‘ä»¬å‘ç°ï¼Œé™¤äº†æ–¹æ³•æ”¾å›ç»™æˆ‘ä»¬ä¸€ä¸ªå®ä¾‹åŒ–å‡ºæ¥çš„ <code>Bitmap</code> å›¾ç‰‡ä¹‹å¤–ï¼Œè¿™ä¸ª <code>Options</code> å¯¹è±¡ä¸­é•¿åº¦ã€å®½åº¦ã€ç±»å‹ç­‰ç­‰å±æ€§ï¼Œä¹Ÿéƒ½è¢«è®¾ç½®æˆäº†äº†æˆ‘ä»¬å›¾ç‰‡çš„ç›¸åº”å±æ€§ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ï¼šé€šè¿‡å°† <code>Options</code> å¯¹è±¡ä¼ å…¥ï¼Œæ¥è·å¾—å›¾ç‰‡çš„åŸå§‹å°ºå¯¸ï¼Œä¸ºåæœŸçš„å‹ç¼©åšå‡†å¤‡ï¼Œè¯´å¹²å°±å¹²ï¼Œæˆ‘ä»¬å°† <code>Options</code> å¯¹è±¡ï¼Œå’Œ <code>Resources</code>ä¸­ä¸€å¼  4k å›¾ç‰‡çš„<code>id</code> ä¸€å—ä¼ å…¥ä¸Šè¯‰æ–¹æ³•ä¸­ï¼Œæ¥å°è¯•è·å¾—å®ƒçš„å°ºå¯¸ï¼Œç»“æœæˆ‘ä»¬å‘ç°ï¼šç¨‹åº <code>OOM</code> å´©æºƒäº†ï¼</p><p>ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Ÿé¦–å…ˆæˆ‘ä»¬æƒ³æƒ³æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è·å¾—è¿™ä¸ª<code>Options</code> å¯¹è±¡ï¼Ÿæ—¶ä¸ºäº†è·å¾—å›¾ç‰‡çš„å°ºå¯¸å¤§å°ï¼›é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è·å¾—åŸå›¾å°ºå¯¸å¤§å°ï¼Ÿæ˜¯ä¸ºäº†æŒ‰ç…§åŸå›¾å°ºå¯¸å’Œæ§ä»¶å°ºå¯¸çš„æ¯”ä¾‹ï¼Œå°†å…¶å‹ç¼©ä¸ºé€‚åˆæ˜¾ç¤ºçš„å¤§å°ï¼Ÿé‚£æˆ‘ä»¬åˆä¸ºä»€ä¹ˆè¦å»å‹ç¼©å®ƒä¸ºåˆé€‚çš„å¤§å°å‘¢ï¼Ÿæ˜¯å› ä¸ºå¦‚æœæŒ‰ç…§åŸå¤§å°å»è°ƒç”¨ç›¸åº”çš„ <code>decode...()</code>æ–¹æ³•è§£æå›¾ç‰‡ï¼Œä¼šå¯¼è‡´å†…å­˜å æœ‰ç‡è¿‡é«˜è§¦å‘<code>OOM</code> å¼‚å¸¸ï¼Œè¿›è€Œå¯¼è‡´ç¨‹åºå´©æºƒå•Šï¼æ²¡æƒ³åˆ°çš„æ˜¯ï¼šç»“æœæˆ‘ä»¬ä¸ºäº†è·å¾— <code>Options</code> è€Œè°ƒç”¨äº†ç›¸åº”çš„ <code>decode...()</code> æ–¹æ³•ï¼Œçš„ç¡® <code>Options</code> æ˜¯å¤åˆ¶äº†ï¼Œä½†ç”±äºè¯¥æ–¹æ³•é€‚ç”¨äºç”Ÿæˆå›¾ç‰‡ï¼Œä¹Ÿå°±æ˜¯ <code>Bitmap</code> å¯¹è±¡çš„ã€‚æ‰€ä»¥ç¨‹åºä¹Ÿåœ¨è§£æè¿™å¼ è¶…å¤§å›¾çš„è¿‡ç¨‹ä¸­<code>OOM</code> å´©æºƒäº†</p><p>é‚£ä¹ˆéš¾é“å°±æ²¡æ–¹æ³•äº†å—ï¼Ÿ</p><p>æœ‰çš„ï¼Œæˆ‘ä¹‹å‰è¯´è¿‡ï¼š<code>Option</code> å†…éƒ¨æœ‰ç€ä¼—å¤šå‚æ•°ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå«åšï¼š  <code>inJustDecodeBounds</code> ã€‚è¿™ä¸ªå‚æ•°é»˜è®¤å€¼ä¸º<code>false</code> ã€‚ä½†å¦‚æœæˆ‘ä»¬å…ˆæŠŠè¿™ä¸ªå‚æ•°è®¾ç½®ä¸º true  æ—¶ï¼Œè¯¥æ–¹æ³•ä¾¿ä¸åœ¨ä¼šå»ç”Ÿæˆç›¸åº”çš„ <code>Bitmap</code> ï¼Œè€Œä»…ä»…æ˜¯å»æµ‹é‡å›¾ç‰‡çš„å„ç§å±æ€§ï¼Œå¦‚é•¿åº¦ã€å®½åº¦ã€ç±»å‹ç­‰ç­‰ï¼Œç„¶åæ”¾å›ä¸€ä¸ª <code>null</code> ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ï¼šå¯ä»¥å…ˆé€šè¿‡å°† <code>inJustDecodeBounds</code> çš„å€¼è®¾ä¸º <code>true</code> ï¼Œå†å»è°ƒç”¨ç›¸åº”çš„ç›¸åº”çš„ <code>decode...()</code>æ–¹æ³•ï¼Œæœ€åå†å°†<code>inJustDecodeBounds</code> çš„å€¼æ”¹å› <code>false</code> ã€‚è¿™ç§åšæ³•æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</p><ol><li>æ—¢èƒ½è·å¾—å›¾ç‰‡å¤§å°ï¼Œç”±äºåç»­æ“ä½œ</li><li>åˆæˆåŠŸé¿å…äº†å»è§£æå›¾ç‰‡ï¼Œå¯¼è‡´ç¨‹åº <code>OOM</code> è€Œå´©æºƒã€‚</li></ol><p>ä½†è¿™æ°æ°æ˜¯è¢«å¾ˆå¤šäººæ‰€å¿½ç•¥çš„ä¸€ç‚¹ã€‚</p><h4 id="å¥½äº†ï¼Œç°åœ¨ç»™å‡ºå…·ä½“çš„å®ç°ï¼š"><a href="#å¥½äº†ï¼Œç°åœ¨ç»™å‡ºå…·ä½“çš„å®ç°ï¼š" class="headerlink" title="å¥½äº†ï¼Œç°åœ¨ç»™å‡ºå…·ä½“çš„å®ç°ï¼š"></a>å¥½äº†ï¼Œç°åœ¨ç»™å‡ºå…·ä½“çš„å®ç°ï¼š</h4><pre><code class="java">    public static void calculateOptionsById(@NonNull Resources res,@NonNull BitmapFactory.Options options, int imgId) {        BitmapFactory.decodeResource(res, imgId, options);    }</code></pre><blockquote><p>å¤§å®¶å¯èƒ½å‘ç°ï¼Œè¿™é‡Œåªå°† <code>inJustDecodeBounds</code> è®¾ä¸º<code>true</code>å´æ²¡æœ‰æ”¹å›<code>false</code> ï¼Œè¿™æ˜¯å› ä¸ºè·å¾— <code>Options</code> åªæ˜¯å›¾ç‰‡å‹ç¼©çš„ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨åç»­æ–¹æ³•ä¸­å°†ä¼šè¿›è¡Œä¿®æ”¹</p></blockquote><h1 id="å¦‚ä½•è¿›è¡Œå‹ç¼©"><a href="#å¦‚ä½•è¿›è¡Œå‹ç¼©" class="headerlink" title="å¦‚ä½•è¿›è¡Œå‹ç¼©"></a>å¦‚ä½•è¿›è¡Œå‹ç¼©</h1><hr><p>æˆ‘ä»¬ç»§ç»­çœ‹ <code>Options</code> çš„æ„æˆã€‚æˆ‘ä»¬å‘ç°ï¼Œå…¶ä¸­æœ‰ä¸ªåä¸º <code>inSampleSize</code> çš„æ•°æ®æˆå‘˜ï¼Œä»–å°±æ˜¯å…³é”®æ‰€åœ¨ï¼Œé‚£ä¹ˆä»–æœ‰ç€ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ</p><p>è¿™é‡Œæˆ‘ç»™å¤§å®¶ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘è¿™æœ‰å¼  4000*1000 åƒç´ çš„å›¾ç‰‡ï¼š</p><ul><li>å½“æˆ‘ä»¬æŠŠ <code>inSampleSize</code>  çš„å€¼è®¾ä¸º <code>4</code>æ—¶ï¼Œæœ€åç”Ÿæˆå‡ºæ¥çš„å›¾ç‰‡å¤§å°å°†ä¼šæ˜¯ï¼š1000 x 250 åƒç´  </li><li>å½“æˆ‘ä»¬æŠŠ<code>inSampleSize</code> çš„å€¼è®¾ä¸º<code>5</code>æ—¶ï¼Œæœ€åç”Ÿæˆå‡ºæ¥çš„å›¾ç‰‡å¤§å°å°†ä¼šæ˜¯ï¼š800 x 200 åƒç´ ã€‚è¿™æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µï¼Ÿ</li></ul><p>è¿™ä¸ä»…ä»…æ˜¯é•¿å®½éƒ½å˜ä¸ºåŸæ¥å››åˆ†ä¹‹ä¸€æˆ–è€…äº”åˆ†ä¹‹ä¸€è¿™ä¹ˆç®€å•ï¼Œè€Œæ˜¯å…¶å›¾ç‰‡å¤§å°ï¼Œç›´æ¥å˜ä¸ºåŸå›¾çš„ <code>1/(n^2)</code>ï¼ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul><li>å¦‚æœåŸå›¾ <code>2MB</code>ï¼Œé‚£ä¹ˆå½“ <code>inSampleSize</code>  èµ‹å€¼ä¸º<code>4</code>åŠ è½½æ—¶å°±åªéœ€è¦ <code>0.125MB</code></li><li>é‚£ å¦‚æœ <code>inSampleSize</code>  èµ‹å€¼ä¸º <code>5</code> å‘¢ï¼Ÿåªéœ€è¦ <code>0.08 MB</code>ï¼è¿<code>100k</code> éƒ½ä¸åˆ°çš„å°å›¾å•Šï¼</li></ul><h4 id="é‚£ä¹ˆä¸‹é¢æˆ‘å°±ç»™å‡ºè¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼š"><a href="#é‚£ä¹ˆä¸‹é¢æˆ‘å°±ç»™å‡ºè¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼š" class="headerlink" title="é‚£ä¹ˆä¸‹é¢æˆ‘å°±ç»™å‡ºè¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼š"></a>é‚£ä¹ˆä¸‹é¢æˆ‘å°±ç»™å‡ºè¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼š</h4><pre><code class="java">    public static int calculateInSamplesizeByOptions(@NonNull BitmapFactory.Options options, int reqWidth, int reqHeight) {        int inSamplesize   = 1;        int originalWidth  = options.outWidth;        int originalHeight = options.outHeight;        if (originalHeight &gt; reqHeight || originalWidth &gt; reqWidth) {            int heightRatio = originalHeight / reqHeight;            int widthRatio  = originalWidth  / reqWidth;            inSamplesize = heightRatio &gt; widthRatio ? heightRatio : widthRatio;        }        return inSamplesize;    }</code></pre><p>æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œæˆ‘å…ˆè®¡ç®—å‡ºäº†ï¼ŒåŸå›¾å°ºå¯¸ä¸ç›®æ ‡å¤§å°å¤§æ¯”ä¾‹ï¼Œåœ¨ä¸‰ç›®è¿ç®—ç¬¦ä¸­ï¼Œå°†<code>inSamplesize</code> èµ‹å€¼ä¸ºè¾ƒå¤§çš„ä¸€ä¸ªã€‚ä¸ºä»€ä¹ˆä¸ç”¨å°çš„é‚£ä¸€ä¸ªå‘¢ï¼Ÿè¿™é‡Œæˆ‘å°±å–ä¸ªå…³å­ï¼Œå¤§å®¶å¯ä»¥åœ¨è¯„è®ºåŒºä¸­å‘è¡¨è‡ªå·±çš„æƒ³æ³•</p><h1 id="ç”Ÿæˆç›®æ ‡å›¾ç‰‡"><a href="#ç”Ÿæˆç›®æ ‡å›¾ç‰‡" class="headerlink" title="ç”Ÿæˆç›®æ ‡å›¾ç‰‡"></a>ç”Ÿæˆç›®æ ‡å›¾ç‰‡</h1><hr><p>ç»è¿‡å‰é¢çš„ä¸¤ä¸ªæ­¥éª¤ï¼Œæƒ³å¿…å¤§å®¶å·²ç»èƒ½å‹¾å‹’å¤„è¿™æœ€åä¸€æ­¥çš„åšæ³•äº†ï¼Œæ€è·¯éå¸¸ç®€å•ï¼š</p><ol><li>å…ˆç”Ÿæˆä¸€ä¸ª <code>Options</code>å¯¹è±¡</li><li>å°† <code>Options çš„ inJustDecodeBounds</code>è®¾ç½®ä¸º<code>true</code></li><li>æ¥ç€è°ƒç”¨æ–¹æ³•ä¸€<code>calculateOptionsById</code>è·å¾—åŸå›¾å°ºå¯¸åˆ°<code>Options</code>ä¸­</li><li>è°ƒç”¨æ–¹æ³•ä¸‰<code>calculateInSamplesizeByOptions</code> è·å¾—ç›¸åº”çš„<code>inSampleSize</code> å¯¹è±¡</li><li>å°† <code>Options</code>çš„<code>inJustDecodeBounds</code>æ”¹å› <code>false</code></li><li>å†æ¬¡è°ƒç”¨ <code>decode...()</code>æ–¹æ³•ï¼ˆè¿™é‡Œæ˜¯ <code>decodeResource</code> ï¼‰è·å¾—å‹ç¼©åçš„ <code>Bitmap</code>å¯¹è±¡</li></ol><h4 id="å…·ä½“å®ç°å¦‚ä¸‹"><a href="#å…·ä½“å®ç°å¦‚ä¸‹" class="headerlink" title="å…·ä½“å®ç°å¦‚ä¸‹"></a>å…·ä½“å®ç°å¦‚ä¸‹</h4><pre><code class="java">    public static Bitmap decodeBitmapById (@NonNull Resources res, int resId, int reqWidth, int reqHeight) {        BitmapFactory.Options options = new BitmapFactory.Options();        options.inJustDecodeBounds = true;        calculateOptionsById(res, options, resId);        options.inSampleSize = calculateInSamplesizeByOptions(options, reqWidth, reqHeight);        options.inJustDecodeBounds = false;        Bitmap bitmap = BitmapFactory.decodeResource(res, resId, options);        return bitmap;    }</code></pre><p>éå¸¸æ£’ï¼Œæˆ‘ä»¬èµ¶ç´§çœ‹çœ‹æ•ˆæœï¼š</p><p><img src="https://img-blog.csdnimg.cn/2019100116455266.png" srcset="/img/loading.gif" alt></p><p>å¤ªæ£’äº†ï¼Œå‡ ä¹å’ŒåŸå›¾æ•ˆæœä¸€æ‘¸ä¸€æ ·ï¼Œä½†è½¯ä»¶è¿è¡Œçš„æµç•…æ€§ç¡®å¤§å¤§æé«˜äº†ï¼ä½†æ˜¯ï¼Œè¿™çœŸçš„å°±å®Œç¾äº†å—ï¼Ÿ</p><p>æœ€æ±‚å®Œç¾çš„æˆ‘ä»¬å¯èƒ½ä¼šæœ‰ä¸ªæƒ³æ³•ï¼šå¦‚æœè°ƒç”¨æˆ‘ä»¬æ–¹æ³•çš„äººï¼Œæˆ–è€…è¯´ç‰¹æ®Šæ—¶å€™çš„æˆ‘ä»¬ã€‚ä¸æƒ³ç”¨è¿™ä¸ªå·²ç»å†™å¥½çš„ <code>decodeBitmapById</code>æ–¹æ³•ï¼Œè€Œæ˜¯åƒè‡ªå·±é€šè¿‡å‰ä¸¤ä¸ªæ–¹æ³•ï¼š<code>calculateOptionsById</code>  <code>calculateInSamplesizeByOptions</code> æ¥å®ç°å›¾ç‰‡å‹ç¼©åŠŸèƒ½ï¼Œè¿™æ˜¯é—®é¢˜å°±å‡ºç°äº†ï¼š</p><ul><li>è°ƒç”¨ <code>calculateOptionsById</code>  å‰å¯èƒ½å¿˜è®°ï¼Œè®¾ç½® <code>inJustDecodeBound</code> ä¸º <code>true</code> ï¼Œè¿›è€Œå¯¼è‡´è®¡ç®—è¶…å¤§å›¾æ—¶ï¼Œç›´æ¥å‘ç”Ÿ <code>OOM</code></li><li>è°ƒç”¨å®Œ <code>calculateInSamplesizeByOptions</code> åå¯èƒ½å¿˜è®°ï¼Œè®¾ç½®<code>inJustDecodeBounds</code> ä¸º <code>false</code>ï¼Œè¿›è€Œå¯¼è‡´æ— æ³•è·å¾—<code>Bitmap</code> å¯¹è±¡ï¼Œä¸€è„¸æ‡µé€¼</li><li>å•¥éƒ½åšäº†ç»“æœè°ƒç”¨å®Œ <code>calculateInSamplesizeByOptions</code> æ²¡æŠŠæ²¡å›çš„å€¼èµ‹ç»™ <code>options.inSampleSize</code> ï¼Œç™½å¿™æ´»ä¸€åœº</li></ul><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¼˜åŒ–ä¸€ä¸‹ï¼š</p><p>é¦–å…ˆï¼Œåœ¨<code>calculateOptionsById</code>ä¸­ï¼Œé»˜è®¤å°† <code>options.inJustDecodeBounds</code> è®¾ç½®ä¸º<code>true</code>ï¼š</p><pre><code class="java">    public static void calculateOptionsById(@NonNull Resources res,@NonNull BitmapFactory.Options options, int imgId) {        options.inJustDecodeBounds = true;        BitmapFactory.decodeResource(res, imgId, options);    }</code></pre><p>å…¶æ¬¡ï¼Œåœ¨ <code>calculateInSamplesizeByOptions</code>æœ€åï¼Œé»˜è®¤å°† <code>options.inJustDecodeBounds</code>è®¾ç½®ä¸º<code>false</code>ï¼š</p><pre><code class="java">    public static int calculateInSamplesizeByOptions(@NonNull BitmapFactory.Options options, int reqWidth, int reqHeight) {        int inSamplesize   = 1;        int originalWidth  = options.outWidth;        int originalHeight = options.outHeight;        if (originalHeight &gt; reqHeight || originalWidth &gt; reqWidth) {            int heightRatio = originalHeight / reqHeight;            int widthRatio  = originalWidth  / reqWidth;            inSamplesize = heightRatio &gt; widthRatio ? heightRatio : widthRatio;        }        options.inJustDecodeBounds = false;        return inSamplesize;    }</code></pre><p>ä¸ºä»€ä¹ˆä¸åœ¨è¯¥æ–¹æ³•åé¢ï¼Œå¯¹ <code>options.inSampleSize</code>è¿›è¡Œèµ‹å€¼å‘¢ï¼Ÿè¿™ä¸»è¦æ˜¯é˜²æ­¢ï¼Œæœ‰æ—¶æˆ‘ä»¬å¯èƒ½åªæƒ³å¾—åˆ°è®¡ç®—ç›¸åº”æ¯”ä¾‹æ¥åšå…¶ä»–æ“ä½œï¼Œè€Œä¸æƒ³æ”¹å˜åŸæœ‰å±æ€§ï¼Œæ‰€ä»¥æ˜¯å¦èµ‹å€¼ï¼Œå°±äº¤ç»™ç”¨æˆ·å»é€‰æ‹©å§</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><hr><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œä¸ºæ­¢ï¼Œå†æ—¶æœ‰å…³å›¾ç‰‡å‹ç¼©çš„æ‰€æœ‰å‘å‘æ´¼æ´¼éƒ½å·²ç»æ€»ç»“å¥½äº†ï¼Œæˆ‘ä»¬ä»å¤´ç†ä»¥è¾¹æ€è·¯ï¼š</p><ol><li>å€ŸåŠ©<code>options.inJustDecodeBounds</code> å‚æ•°èµ‹å€¼<code>true</code>æ—¶ï¼Œä¸ç”Ÿæˆå›¾ç‰‡çš„ç‰¹æ€§ï¼Œå°†åŸå›¾å°ºå¯¸ä¿å­˜åœ¨ <code>Options</code> ä¸­</li><li>é€šè¿‡ <code>options</code> ä¸­åŸå›¾å°ºå¯¸ä¸ç›®æ ‡ï¼ˆæ§ä»¶ï¼‰å°ºå¯¸çš„æ¯”ä¾‹ï¼Œå¯¹ <code>options.inSampleSize</code> è¿›è¡Œè®¾ç½®</li><li>ç”Ÿæˆç›®æ ‡å›¾ç‰‡</li><li>å‹ç¼©çš„é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯æ¯æ¬¡æ‰“å¼€å›¾ç‰‡éƒ½å‹ç¼©ä¹Ÿå¤ªéº»çƒ¦äº†ï¼ä¸‹é¢æˆ‘å°†é’ˆå¯¹è¿™ä¸ªé—®é¢˜è¿›è¡Œæ›´æœ‰æ•ˆåœ°è§£å†³ ï¼Œæœ‰å…´è¶£å¯ä»¥ç»§ç»­å…³æ³¨ <strong><a href="https://blog.csdn.net/qq_43377749" target="_blank" rel="noopener">_yuanhao çš„ç¼–ç¨‹ä¸–ç•Œ</a></strong></li></ol><h1 id="ç›¸å…³æ–‡ç« "><a href="#ç›¸å…³æ–‡ç« " class="headerlink" title="ç›¸å…³æ–‡ç« "></a>ç›¸å…³æ–‡ç« </h1><hr><p><a href="https://blog.csdn.net/qq_43377749/article/details/101197865" target="_blank" rel="noopener">Android è®©ä½ çš„ Room æ­ä¸Š RxJava çš„é¡ºé£è½¦ ä»é‡å¤çš„ä»£ç ä¸­è§£è„±å‡ºæ¥</a></p><p><a href="https://blog.csdn.net/qq_43377749/article/details/100856599" target="_blank" rel="noopener">ViewModel å’Œ ViewModelProvider.Factoryï¼šViewModel çš„åˆ›å»ºè€…</a></p><p><a href="https://blog.csdn.net/qq_43377749/article/details/96324909" target="_blank" rel="noopener">å•ä¾‹æ¨¡å¼-å…¨å±€å¯ç”¨çš„ context å¯¹è±¡ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></p><p><a href="https://blog.csdn.net/qq_43377749/article/details/94156207" target="_blank" rel="noopener">ç¼©æ”¾æ‰‹åŠ¿ ScaleGestureDetector æºç è§£æï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></p><p><a href="https://blog.csdn.net/qq_43377749/article/details/94155960" target="_blank" rel="noopener">çœ‹å®Œè¿™ç¯‡è¿˜ä¸ä¼š GestureDetector æ‰‹åŠ¿æ£€æµ‹ï¼Œæˆ‘è·ªæ“è¡£æ¿ï¼</a></p><p><a href="https://blog.csdn.net/qq_43377749/article/details/92629161" target="_blank" rel="noopener">Android å±æ€§åŠ¨ç”»æ¡†æ¶ ObjectAnimatorã€ValueAnimator ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></p><p><a href="https://blog.csdn.net/qq_43377749/article/details/92425865" target="_blank" rel="noopener">Android é€å¸§åŠ¨ç”»ï¼ˆ Drawable åŠ¨ç”»ï¼‰ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></p><p><a href="https://blog.csdn.net/qq_43377749/article/details/91890323" target="_blank" rel="noopener">çœ‹å®Œè¿™ç¯‡å†ä¸ä¼š View çš„åŠ¨ç”»æ¡†æ¶ï¼Œæˆ‘è·ªæ“è¡£æ¿</a></p><p><a href="https://blog.csdn.net/qq_43377749/article/details/91474208" target="_blank" rel="noopener">Android è‡ªå®šä¹‰æ—¶é’Ÿæ§ä»¶ æ—¶é’ˆã€åˆ†é’ˆã€ç§’é’ˆçš„ç»˜åˆ¶è¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></p><p><a href="https://blog.csdn.net/qq_43377749/article/details/91379915" target="_blank" rel="noopener">android è‡ªå®šä¹‰æ§ä»¶ä¹‹-ç»˜åˆ¶é’Ÿè¡¨ç›˜</a></p><h3 id="è¯·ç‚¹èµï¼å› ä¸ºä½ çš„é¼“åŠ±æ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼"><a href="#è¯·ç‚¹èµï¼å› ä¸ºä½ çš„é¼“åŠ±æ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼" class="headerlink" title="è¯·ç‚¹èµï¼å› ä¸ºä½ çš„é¼“åŠ±æ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼"></a>è¯·ç‚¹èµï¼å› ä¸ºä½ çš„é¼“åŠ±æ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼</h3><hr><p>æºç  Demo é“¾æ¥ï¼š<strong><a href="https://github.com/FishInWater-1999/Drop/blob/master/app/src/main/java/com/example/drop/utils/BitmapBuilder.java" target="_blank" rel="noopener">Drop æˆ‘ç¬¬ä¸€æ¬¡å†™çš„ Android é¡¹ç›®ï¼Œå¸Œæœ›å¤§å®¶ç‚¹æ­Œ star~ è°¢è°¢ï¼</a></strong></p>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OOM</tag>
      
      <tag>å›¾ç‰‡å‹ç¼©</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android è®©ä½ çš„ Room æ­ä¸Š RxJava çš„é¡ºé£è½¦ ä»é‡å¤çš„ä»£ç ä¸­è§£è„±å‡ºæ¥</title>
    <link href="undefined2019/10/03/Android%20%E8%AE%A9%E4%BD%A0%E7%9A%84%20Room%20%E6%90%AD%E4%B8%8A%20RxJava%20%E7%9A%84%E9%A1%BA%E9%A3%8E%E8%BD%A6%20%E4%BB%8E%E9%87%8D%E5%A4%8D%E7%9A%84%E4%BB%A3%E7%A0%81%E4%B8%AD%E8%A7%A3%E8%84%B1%E5%87%BA%E6%9D%A5/"/>
    <url>2019/10/03/Android%20%E8%AE%A9%E4%BD%A0%E7%9A%84%20Room%20%E6%90%AD%E4%B8%8A%20RxJava%20%E7%9A%84%E9%A1%BA%E9%A3%8E%E8%BD%A6%20%E4%BB%8E%E9%87%8D%E5%A4%8D%E7%9A%84%E4%BB%A3%E7%A0%81%E4%B8%AD%E8%A7%A3%E8%84%B1%E5%87%BA%E6%9D%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯-Room-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Room-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Room ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Room ï¼Ÿ</h1><hr><p>è°·æ­Œä¸ºäº†å¸®åŠ©å¼€å‘è€…è§£å†³ Android æ¶æ„è®¾è®¡é—®é¢˜ï¼Œåœ¨ Google I/O 2017 å‘å¸ƒä¸€å¥—å¸®åŠ©å¼€å‘è€…è§£å†³ Android æ¶æ„è®¾è®¡çš„æ–¹æ¡ˆï¼šAndroid Architecture Componentsï¼Œè€Œæˆ‘ä»¬çš„ Room æ­£æ˜¯è¿™å¥—æ–¹æ¡ˆçš„ä¸¤å¤§æ¨¡å—ä¹‹ä¸€ã€‚</p><ul><li>å®šä¹‰ï¼šæ•°æ®åº“è§£å†³æ–¹æ¡ˆ</li><li>ç»„æˆï¼šDatabaseã€Entityã€DAO</li></ul><h1 id="ä¸ºä»€ä¹ˆæœ¬æ–‡å«è°·æ­ŒèŒƒä¾‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæœ¬æ–‡å«è°·æ­ŒèŒƒä¾‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæœ¬æ–‡å«è°·æ­ŒèŒƒä¾‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæœ¬æ–‡å«è°·æ­ŒèŒƒä¾‹ï¼Ÿ</h1><hr><p>ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…è¿›è¡Œå­¦ä¹ å’Œç†è§£ï¼ŒGoogle åœ¨ GitHub ä¸Šä¸Šä¼ äº†ä¸€ç³»åˆ—çš„ Android Architecture Components å¼€æºä»£ç ï¼š<a href="https://github.com/googlesamples/android-architecture-components" target="_blank" rel="noopener">googlesamples/android-architecture-components</a> æœ¬æ–‡å°±æ˜¯é€šè¿‡è§£æè¿™å¥—èŒƒä¾‹çš„ç¬¬ä¸€éƒ¨åˆ†ï¼š<a href="https://github.com/googlesamples/android-architecture-components/tree/master/BasicRxJavaSample" target="_blank" rel="noopener">BasicRxJavaSample</a> æ¥å¯¹ Room çš„ä½¿ç”¨è¿›è¡Œåˆ†æã€‚</p><p>å…³äºæœ¬æ–‡ä¸­çš„ä»£ç ä»¥åŠåç»­æ–‡ç« ä¸­çš„ä»£ç ï¼Œæˆ‘å·²ç»ä¸Šä¼ è‡³æˆ‘çš„ GitHub æ¬¢è¿å¤§å®¶å›´è§‚ã€star<br>è¯¦è§-&gt; <a href="https://github.com/FishInWater-1999/ArchitectureComponentsStudy" target="_blank" rel="noopener">FishInWater-1999/ArchitectureComponentsStudy</a></p><h1 id="å¼€å§‹ä¹‹å‰"><a href="#å¼€å§‹ä¹‹å‰" class="headerlink" title="å¼€å§‹ä¹‹å‰"></a>å¼€å§‹ä¹‹å‰</h1><hr><h4 id="ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦-Room"><a href="#ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦-Room" class="headerlink" title="ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦ Room"></a>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å­¦ Room</h4><p>ç›¸æ¯”äºæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ <code>Java</code> ä»£ç è¿›è¡Œ <code>SQLite</code> æ“ä½œï¼Œæ¯æ¬¡éƒ½éœ€è¦æ‰‹å†™å¤§é‡é‡å¤çš„ä»£ç ï¼Œå¯¹äºæˆ‘ä»¬æœ€æ±‚æ¢¦æƒ³çš„ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™ç§æ— èŠçš„è¿‡ç¨‹ç®€ç›´æ˜¯ä¸€ç§æŠ˜ç£¨ã€‚äºæ˜¯ï¼Œ<code>Room</code> ä¹Ÿå°±åº”è¿è€Œç”Ÿäº†</p><ul><li>å®ƒé€šè¿‡æ³¨è§£å¤„ç†å™¨çš„å½¢å¼ï¼Œå°†ç¹çæ— è¶£çš„ä»£ç å°è£…èµ·æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªç®€å•çš„æ³¨è§£ï¼Œå°±å¯ä»¥å®Œæˆä¸€ç³»åˆ—å¤æ‚çš„åŠŸèƒ½ï¼</li></ul><blockquote><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸‹ <code>Room</code> çš„åŸºæœ¬ç»„æˆ</p></blockquote><p>å‰é¢æˆ‘ä»¬å·²ç»è¯´è¿‡ Room çš„ä½¿ç”¨ï¼Œä¸»è¦ç”± Databaseã€Entityã€DAO ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼Œé‚£ä¹ˆè¿™ä¸‰å¤§ç»„æˆéƒ¨åˆ†åˆåˆ†åˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>Databaseï¼šåˆ›å»ºä¸€ä¸ªç”± Room ç®¡ç†çš„æ•°æ®åº“ï¼Œå¹¶åœ¨å…¶ä¸­è‡ªå®šä¹‰æ‰€éœ€è¦æ“ä½œçš„æ•°æ®åº“è¡¨</li></ul><h6 id="è¦æ±‚ï¼š"><a href="#è¦æ±‚ï¼š" class="headerlink" title="è¦æ±‚ï¼š"></a>è¦æ±‚ï¼š</h6><pre><code>   1. å¿…é¡»æ˜¯abstractç±»è€Œä¸”çš„extends RoomDatabaseã€‚   2. å¿…é¡»åœ¨ç±»å¤´çš„æ³¨é‡Šä¸­åŒ…å«ä¸æ•°æ®åº“å…³è”çš„å®ä½“åˆ—è¡¨(Entityå¯¹åº”çš„ç±»)ã€‚   3. åŒ…å«ä¸€ä¸ªå…·æœ‰0ä¸ªå‚æ•°çš„æŠ½è±¡æ–¹æ³•ï¼Œå¹¶è¿”å›ç”¨@Daoæ³¨è§£çš„ç±»ã€‚</code></pre><h6 id="ä½¿ç”¨ï¼š"><a href="#ä½¿ç”¨ï¼š" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h6><p>é€šè¿‡å•ä¾‹æ¨¡å¼å®ç°ï¼Œä½ å¯ä»¥é€šè¿‡é™æ€ getInstance(â€¦) æ–¹æ³•ï¼Œè·å–æ•°æ®åº“å®ä¾‹ï¼š</p><p><code>public static UsersDatabase getInstance(Context context)</code></p><ul><li><p>Entityï¼šæ•°æ®åº“ä¸­ï¼ŒæŸä¸ªè¡¨çš„å®ä½“ç±»ï¼Œå¦‚ï¼š<br><code>@Entity(tableName = &quot;users&quot;)</code><br><code>public class User {...}</code></p></li><li><p>DAOï¼šå…·ä½“è®¿é—®æ•°æ®åº“çš„æ–¹æ³•çš„æ¥å£<br><code>@Dao</code><br><code>public interface UserDao {...}</code></p></li></ul><h1 id="BasicRxJavaSample-æºç è§£æ"><a href="#BasicRxJavaSample-æºç è§£æ" class="headerlink" title="BasicRxJavaSample æºç è§£æ"></a>BasicRxJavaSample æºç è§£æ</h1><hr><p>ç”±äºæ˜¯æºç è§£æï¼Œé‚£æˆ‘å°±ä»¥ï¼šä»åŸºç¡€çš„ç±»å¼€å§‹ï¼Œä¸€å±‚å±‚å‘ä¸Šï¼ŒæŠ½ä¸å‰¥èŒ§ï¼Œæœ€åèä¸ºä¸€ä½“çš„æ–¹å¼ï¼Œç»™å¤§å®¶è¿›è¡Œè§£æã€‚é‚£ä¹ˆç°åœ¨å°±è®©æˆ‘ä»¬å¼€å§‹å§ã€‚</p><h4 id="è¡¨çš„æ­å»º"><a href="#è¡¨çš„æ­å»º" class="headerlink" title="è¡¨çš„æ­å»º"></a>è¡¨çš„æ­å»º</h4><p>Room ä½œä¸ºä¸€ä¸ª Android æ•°æ®åº“æ“ä½œçš„æ³¨è§£é›†åˆï¼Œæœ€åŸºæœ¬æ“ä½œå°±æ˜¯å¯¹æˆ‘ä»¬æ•°æ®åº“è¿›è¡Œçš„ã€‚æ‰€ä»¥ï¼Œå…ˆè®©æˆ‘ä»¬è¯•ç€å»ºç«‹ä¸€å¼ åä¸º â€œusersâ€ çš„æ•°æ®è¡¨</p><pre><code class="java">/** * åº”ç”¨æµ‹è¯•çš„è¡¨ç»“æ„æ¨¡å‹ */@Entity(tableName = &quot;users&quot;)// è¡¨åæ³¨è§£public class User {    /**     * ä¸»é”®     * ç”±äºä¸»é”®ä¸èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥éœ€è¦ @NonNull æ³¨è§£     */    @NonNull    @PrimaryKey    @ColumnInfo(name = &quot;userid&quot;)// Room åˆ—æ³¨è§£    private String mId;    /**     * ç”¨æˆ·å     * æ™®é€šåˆ—     */    @ColumnInfo(name = &quot;username&quot;)    private String mUserName;    /**     * æ„é€ æ–¹æ³•     * è®¾ç½®ä¸º @Ignore å°†å…¶å¿½è§†     * è¿™æ ·ä»¥æ¥ï¼Œè¿™ä¸ªæ³¨è§£æ–¹æ³•å°±ä¸ä¼šè¢«ä¼ å…¥ Room ä¸­ï¼Œåšç›¸åº”å¤„ç†     * @param mUserName     */    @Ignore    public User(String mUserName){        this.mId    = UUID.randomUUID().toString();        this.mUserName = mUserName;    }    /**     * æˆ‘ä»¬å‘ç°ä¸ä¸Šä¸ªæ–¹æ³•ä¸åŒï¼Œè¯¥æ–¹æ³•æ²¡æœ‰æ ‡è®° @Ignore æ ‡ç­¾     *      * æ‰€ä»¥ç¼–è¯‘æ—¶è¯¥æ–¹æ³•ä¼šè¢«ä¼ å…¥ Room ä¸­ç›¸åº”çš„æ³¨è§£å¤„ç†å™¨ï¼Œåšç›¸åº”å¤„ç†     * è¿™é‡Œçš„å¤„ç†åº”è¯¥æ˜¯ add æ–°æ•°æ®     * @param id     * @param userName     */    public User(String id, String userName) {        this.mId = id;        this.mUserName = userName;    }    public String getId() {        return mId;    }    public String getUserName() {        return mUserName;    }}</code></pre><p>é¦–å…ˆåœ¨è¡¨å¤´éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°±è§åˆ°äº†ä¹‹å‰è¯´è¿‡çš„ <code>@Entity(...)</code> æ ‡ç­¾ï¼Œä¹‹å‰è¯´è¿‡è¯¥æ ‡ç­¾è¡¨ç¤ºæ•°æ®åº“ä¸­æŸä¸ªè¡¨çš„å®ä½“ç±»ï¼Œæˆ‘ä»¬æŸ¥çœ‹å®ƒçš„æºç ï¼š</p><pre><code class="java">@Target(ElementType.TYPE)@Retention(RetentionPolicy.CLASS)public @interface Entity {...}</code></pre><p>ä»ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“è¯¥æ³¨è§£å®åœ¨ç¼–è¯‘æ³¨è§£æ‰€åœ¨çš„ç±»æ—¶è§¦å‘çš„ï¼Œè¿™æ˜¯æˆ‘ä»¬æ³¨æ„åˆ° Google å¯¹è¯¥ç±»çš„ä»‹ç»æ˜¯ï¼š</p><pre><code class="xml">Marks a class as an entity. This class will have a mapping SQLite table in the database.</code></pre><p>ç”±æ­¤å¯çŸ¥å½“æ³¨è§£æ‰€åœ¨çš„ç±»ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„è¿™ä¸ª <code>User</code> ç±»ç¼–è¯‘æ—¶ï¼Œç›¸åº”çš„æ³¨è§£å¤„ç†å™¨å°±ä¼šè°ƒç”¨å…¶å†…éƒ¨ç›¸åº”çš„ä»£ç ï¼Œå»ºç«‹ä¸€ä¸ªåä¸º <code>users</code> ï¼ˆåœ¨ <code>@Entity(tableName = &quot;users&quot;)</code> ä¸­ä¼ å…¥çš„æ•°æ®è¡¨ ï¼‰</p><p><strong>æˆ‘ä»¬å†å¾€ä¸‹çœ‹ï¼š</strong></p><ul><li>@ColumnInfo(name = â€œuseridâ€) ï¼šè¯¥æ³¨è§£æ³¨è§£çš„æ•°æ®æˆå‘˜ï¼Œå°†ä¼šåœ¨è¡¨ä¸­ç”Ÿæˆç›¸åº”çš„åä¸ºï¼š<code>userid</code> çš„åˆ—</li><li>@PrimaryKey ï¼šé¡¾åæ€ä¹‰è¯¥æ³¨è§£ä¸<code>@ColumnInfo(name = &quot;...&quot;)</code> æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼Œè¡¨ç¤ºè¡¨ä¸­çš„ä¸»é”®ï¼Œè¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨ <code>@Entity</code> çš„æºç ä¸­å¼ºè°ƒï¼šEach entity must have at least 1 field annotated with {@link PrimaryKey}. ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªè¢« <code>@Entity(...)</code>  æ ‡æ³¨çš„æ•°æ®è¡¨ç±»ä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ªä¸»é”®</li><li>@Ignore ï¼šè¢«è¯¥æ³¨è§£æ³¨é‡Šçš„æ•°æ®æˆå‘˜ã€æ–¹æ³•ï¼Œå°†ä¼šè¢«æ³¨è§£å¤„ç†å™¨å¿½ç•¥ï¼Œä¸è¿›è¡Œå¤„ç†</li></ul><p>è¿™é‡Œæˆ‘ä»¬å‘ç°ï¼Œä»£ç ä¸­æœ‰å­˜åœ¨ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆ GoogleSample ä¸­ä¼šå­˜åœ¨è¿™ç§çœ‹ä¼¼å¤šæ­¤ä¸€ä¸¾çš„æƒ…å†µå‘¢ï¼Ÿæˆ‘ä»¬å†ä»”ç»†è§‚å¯Ÿå°±ä¼šå‘æƒ³ï¼Œä¸Šæ–¹çš„æ„é€ æ–¹æ³•æ ‡è®°äº† <code>@Ignore</code> æ ‡ç­¾ï¼Œè€Œä¸‹æ–¹çš„æ„é€ æ–¹æ³•å´æ²¡æœ‰ã€‚ç”±äºåœ¨ <code>@Entity</code> æ ‡æ³¨çš„ç±»ä¸­ï¼Œæ„é€ æ–¹æ³•å’Œåˆ—å±æ€§çš„ <code>get()</code> æ–¹æ³•éƒ½ä¼šè¢«æ³¨è§£å¤„ç†å™¨è‡ªåŠ¨è¯†åˆ«å¤„ç†ã€‚æˆ‘ä»¬å°±ä¸éš¾æƒ³åˆ°ï¼ŒGoogle ä¹‹æ‰€ä»¥è¿™æ ·è®¾è®¡ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬äºæ˜¯éœ€è¦åˆ›å»ºä¸´æ—¶çš„ <code>User</code> å¯¹è±¡ï¼Œä½†æˆ‘ä»¬åˆä¸å¸Œæœ› <code>@Entity</code> åœ¨æˆ‘ä»¬è°ƒç”¨æ„é€ æ–¹æ³•æ—¶ï¼Œå°±å°†å…¶å­˜å…¥æ•°æ®åº“ã€‚æ‰€ä»¥æˆ‘ä»¬å°±æœ‰äº†è¿™ä¸ªè¢« <code>@Ignore</code> çš„æ„é€ æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸è¢«è‡ªåŠ¨å­˜å…¥æ•°æ®åº“çš„ä¸´æ—¶å¯¹è±¡ï¼Œç­‰åˆ°æˆ‘ä»¬æƒ³å°†è¿™ä¸ªå¯¹è±¡å­˜å…¥æ•°æ®åº“æ—¶ï¼Œè°ƒç”¨<code>User(String id, String userName)</code> å³å¯ã€‚</p><h4 id="UserDao"><a href="#UserDao" class="headerlink" title="UserDao"></a>UserDao</h4><p>ä¸Šé¢æˆ‘ä»¬é€šè¿‡ <code>@Entity</code> å»ºç«‹äº†ä¸€å¼  <code>users</code> è¡¨ï¼Œä¸‹é¢å°±è®©æˆ‘ä»¬ç”¨ <code>@Dao</code> æ³¨è§£æ¥å˜å†™ <code>UserDao</code> æ¥å£ã€‚</p><pre><code class="java">@Daopublic interface UserDao {    /**     * ä¸ºäº†ç®€ä¾¿ï¼Œæˆ‘ä»¬åªåœ¨è¡¨ä¸­å­˜å…¥1ä¸ªç”¨æˆ·ä¿¡æ¯     * è¿™ä¸ªæŸ¥è¯¢è¯­å¥å¯ä»¥è·å¾— æ‰€æœ‰ User ä½†æˆ‘ä»¬åªéœ€è¦ç¬¬ä¸€ä¸ªå³å¯     * @return     */    @Query(&quot;SELECT * FROM Users LIMIT 1&quot;)    Flowable&lt;User&gt; getUser();    /**     * æƒ³æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡ User å¯¹è±¡     * è‹¥æ•°æ®åº“ä¸­å·²å­˜åœ¨ï¼Œåˆ™å°†å…¶æ›¿æ¢     * @param user     * @return     */    @Insert(onConflict = OnConflictStrategy.REPLACE)    Completable insertUser(User user);    /**     * æ¸…ç©ºæ‰€æœ‰æ•°æ®     */    @Query(&quot;DELETE FROM Users&quot;)    void deleteAllUsers();}</code></pre><p>æŒ‰ç…§æˆ‘ä»¬æ­£å¸¸ç¼–å†™çš„ä¹ æƒ¯ï¼Œæˆ‘ä»¬ä¼šåœ¨è¯¥ç±»ä¸­ï¼Œç¼–å†™ç›¸åº”çš„æ•°æ®åº“æ“ä½œä»£ç ã€‚ä½†ä¸ä¹‹ä¸åŒçš„æ˜¯é‡‡ç”¨ <code>Room</code> ä¹‹åï¼Œæˆ‘ä»¬å°†å…¶å˜ä¸ºä¸€ä¸ªæ¥å£ç±»ï¼Œå¹¶ä¸”åªéœ€è¦ç¼–å†™å’Œè®¾å®šç›¸åº”çš„æ ‡ç­¾å³å¯ï¼Œä¸ç”¨å†å»å…³å¿ƒå­˜å‚¨æ“ä½œçš„å…·ä½“å®ç°ã€‚</p><pre><code class="java">    /**     * ä¸ºäº†ç®€ä¾¿ï¼Œæˆ‘ä»¬åªåœ¨è¡¨ä¸­å­˜å…¥1ä¸ªç”¨æˆ·ä¿¡æ¯     * è¿™ä¸ªæŸ¥è¯¢è¯­å¥å¯ä»¥è·å¾— æ‰€æœ‰ User ä½†æˆ‘ä»¬åªéœ€è¦ç¬¬ä¸€ä¸ªå³å¯     * @return     */    @Query(&quot;SELECT * FROM Users LIMIT 1&quot;)    Flowable&lt;User&gt; getUser();</code></pre><p> è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œè¯¥æŸ¥è¯¢æ–¹æ³•ä½¿ç”¨çš„æ˜¯ <code>@Query</code> æ³¨è§£ï¼Œé‚£ä¹ˆè¿™ä¸ªæ³¨è§£çš„å…·ä½“åŠŸèƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼ŸGoogle å®˜æ–¹å¯¹å®ƒçš„è§£é‡Šæ˜¯ï¼šåœ¨ä¸€ä¸ªè¢«æ ‡æ³¨äº† <code>@Dao</code> æ ‡ç­¾çš„ç±»ä¸­ï¼Œç”¨äºæŸ¥è¯¢çš„æ–¹æ³•ã€‚é¡¾åæ€ä¹‰è¢«è¯¥æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ï¼Œä¼šè¢« <code>Room</code> çš„æ³¨è§£å¤„ç†å™¨è¯†åˆ«ï¼Œå½“ä½œä¸€ä¸ªæ•°æ®æŸ¥è¯¢æ–¹æ³•ï¼Œè‡³äºå…·ä½“çš„æŸ¥è¯¢é€»è¾‘å¹¶ä¸éœ€è¦æˆ‘ä»¬å…³å¿ƒï¼Œæˆ‘ä»¬åªéœ€è¦å°† <code>SQL è¯­å¥</code> ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ <code>@Query(...)</code> ä¸­å³å¯ã€‚ä¹‹åæˆ‘ä»¬å‘ç°ï¼Œè¯¥æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªèƒŒå‹ <code>Flowable&lt;...&gt;</code> ç±»å‹çš„å¯¹è±¡ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢è¡¨ä¸­æ•°æ®è¿‡å¤šï¼Œè¯»å–é€Ÿç‡è¿œå¤§äºæ¥æ”¶æ•°æ®ï¼Œä»è€Œå¯¼è‡´å†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼Œå…·ä½“è¯¦è§ <code>RxJava</code> çš„æ•™ç¨‹ï¼Œè¿™é‡Œæˆ‘å°±ä¸èµ˜è¿°äº†ã€‚</p><pre><code class="java">    /**     * æƒ³æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡ User å¯¹è±¡     * è‹¥æ•°æ®åº“ä¸­å·²å­˜åœ¨ï¼Œåˆ™å°†å…¶æ›¿æ¢     * @param user     * @return     */    @Insert(onConflict = OnConflictStrategy.REPLACE)    Completable insertUser(User user);</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œä¸Šè¿°æ–¹æ³•è¢« <code>@Insert</code> æ³¨è§£æ‰€æ ‡æ³¨ï¼Œä»åå­—å°±èƒ½çœ‹å‡ºï¼Œè¿™å°†ä¼šæ˜¯ä¸€ä¸ªæ’å…¥æ–¹æ³•ã€‚é¡¾åæ€ä¹‰è¢« <code>@Insert</code> æ ‡æ³¨çš„æ–¹æ³•ï¼Œä¼šç”¨äºå‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®ï¼Œå”¯ä¸€è®©æˆ‘ä»¬è¿·èŒ«çš„æ˜¯æ‹¬å·ä¸­çš„è¿™ä¸ª <code>onConflict</code>  å‚æ•°ï¼Œ<code>onConflict</code>  æ„ä¸ºâ€œå†²çªâ€ï¼Œå†è”æƒ³ä¸‹æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­çš„æ•°æ®åº“æ“ä½œï¼Œå°±ä¸éš¾æƒ³åˆ°ï¼šè¿™æ˜¯ç”¨æ¥è®¾å®šï¼Œå½“æ’å…¥æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œä¸åŸæ•°æ®å‘ç”Ÿå†²çªæ—¶çš„å¤„ç†æ–¹æ³•ã€‚è¿™é‡Œæˆ‘ä»¬ä¼ å…¥çš„æ˜¯ <code>OnConflictStrategy.REPLACE</code> ï¼Œæ„ä¸ºâ€œå¦‚æœæ•°æ®å‘ç”Ÿå†²çªï¼Œåˆ™ç”¨å…¶æ›¿æ¢æ‰åŸæ•°æ®â€ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šç›¸åº”æ“ä½œçš„å‚æ•°ï¼Œæ¯”å¦‚<code>ROLLBACK</code> <code>ABORT</code> ç­‰ï¼Œç¯‡å¹…åŸå› å°±ä¸è¯¦ç»†è¯´æ˜äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡ŒæŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚è¿˜æœ‰ä¸€ç‚¹å€¼å¾—è¯´çš„æ˜¯è¿™ä¸ª <code>Completable</code> ï¼Œè¯¥è¿”å›å€¼æ˜¯ <code>RxJava</code> çš„åŸºæœ¬ç±»å‹ï¼Œå®ƒåªå¤„ç† <code>onComplete</code> <code>onError</code> äº‹ä»¶ï¼Œå¯ä»¥çœ‹æˆæ˜¯Rxçš„Runnableã€‚</p><pre><code class="java">    /**     * æ¸…ç©ºæ‰€æœ‰æ•°æ®     */    @Query(&quot;DELETE FROM Users&quot;)    void deleteAllUsers();</code></pre><p>æœ€åè¿™ä¸ªæ–¹æ³•å°±æ˜¯æ¸…ç©º <code>users</code> è¡¨ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œå¾ˆç®€å•ï¼Œè¿™é‡Œå°±ä¸åšè¯´æ˜äº†ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä½¿ç”¨äº† <code>DELETE FROM è¡¨å</code> çš„å½¢å¼ï¼Œè€Œä¸æ˜¯ <code>truncate table è¡¨å</code> ï¼ŒåŒºåˆ«å°±åœ¨äºï¼šæ•ˆç‡ä¸Š<code>truncate</code>æ¯”<code>delete</code>å¿«ï¼Œä½†<code>truncate</code> ç›¸å½“äºä¿ç•™è¡¨çš„ç»“æ„ï¼Œé‡æ–°åˆ›å»ºäº†è¿™ä¸ªè¡¨ï¼Œæ‰€ä»¥åˆ é™¤åä¸è®°å½•æ—¥å¿—ï¼Œä¸å¯ä»¥æ¢å¤æ•°æ®ã€‚</p><h4 id="UsersDatabase"><a href="#UsersDatabase" class="headerlink" title="UsersDatabase"></a>UsersDatabase</h4><p>æœ‰å…³äº <code>Room</code> çš„ä¸‰å¤§ç»„æˆæˆ‘ä»¬å·²ç»è®²å®Œäº†ä¸¤ä¸ªï¼Œç°åœ¨å°±è®©æˆ‘ä»¬çœ‹çœ‹æœ€åä¸€ä¸ª <code>@Database</code> æ³¨è§£ï¼š</p><pre><code class="java">@Database(entities = {User.class}, version = 1, exportSchema = false)public abstract class UsersDatabase extends RoomDatabase {    /**     * å•ä¾‹æ¨¡å¼     * volatile ç¡®ä¿çº¿ç¨‹å®‰å…¨     * çº¿ç¨‹å®‰å…¨æ„å‘³ç€æ”¹å¯¹è±¡ä¼šè¢«è®¸å¤šçº¿ç¨‹ä½¿ç”¨     * å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ç§ â€œç¨‹åº¦è¾ƒè½»çš„ synchronizedâ€     */    private static volatile UsersDatabase INSTANCE;    /**     * è¯¥æ–¹æ³•ç”±äºè·å¾— DataBase å¯¹è±¡     * abstract     * @return     */    public abstract UserDao userDao();    public static UsersDatabase getInstance(Context context) {        // è‹¥ä¸ºç©ºåˆ™è¿›è¡Œå®ä¾‹åŒ–        // å¦åˆ™ç›´æ¥è¿”å›        if (INSTANCE == null) {            synchronized (UsersDatabase.class) {                if (INSTANCE == null){                    INSTANCE = Room.databaseBuilder(context.getApplicationContext(),                            UsersDatabase.class, &quot;Sample.db&quot;)                            .build();                }            }        }        return INSTANCE;    }}</code></pre><p>è€æ ·å­ï¼Œ <code>Google</code> å®šä¹‰ä¸­æ˜¯è¿™ä¹ˆå†™çš„ï¼šå°†ä¸€ä¸ªç±»æ ‡è®°ä¸º <code>Room</code> æ•°æ®åº“ã€‚é¡¾åæ€ä¹‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ ‡è®°äº†è¯¥æ ‡ç­¾çš„ç±»é‡Œï¼Œåšå…·ä½“çš„æ•°æ®åº“æ“ä½œï¼Œæ¯”å¦‚æ•°æ®åº“çš„å»ºç«‹ã€ç‰ˆæœ¬æ›´æ–°ç­‰ç­‰ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œæˆ‘ä»¬å‘å…¶ä¸­ä¼ å…¥äº†å¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬ï¼š<code>entities</code> ä»¥æ•°ç»„ç»“æ„ï¼Œæ ‡è®°ä¸€ç³»åˆ—æ•°æ®åº“ä¸­çš„è¡¨ï¼Œè¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬åªæœ‰ä¸€ä¸ª <code>User</code> è¡¨ï¼Œæ‰€ä»¥åªä¼ å…¥ä¸€ä¸ªï¼› <code>version</code> æ•°æ®åº“ç‰ˆæœ¬ï¼›<code>exportSchema</code> ç”¨äºå†å²ç‰ˆæœ¬åº“çš„å¯¼å‡º</p><pre><code class="java">    /**     * å•ä¾‹æ¨¡å¼     * volatile ç¡®ä¿çº¿ç¨‹å®‰å…¨     * çº¿ç¨‹å®‰å…¨æ„å‘³ç€æ”¹å¯¹è±¡ä¼šè¢«è®¸å¤šçº¿ç¨‹ä½¿ç”¨     * å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ç§ â€œç¨‹åº¦è¾ƒè½»çš„ synchronizedâ€     */    private static volatile UsersDatabase INSTANCE;</code></pre><p> å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªå•ä¾‹æ¨¡å¼ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªå…¨å±€å¯è·å¾—çš„ UsersDatabase å¯¹è±¡ã€‚</p><pre><code class="java">    public static UsersDatabase getInstance(Context context) {        // è‹¥ä¸ºç©ºåˆ™è¿›è¡Œå®ä¾‹åŒ–        // å¦åˆ™ç›´æ¥è¿”å›        if (INSTANCE == null) {            synchronized (UsersDatabase.class) {                if (INSTANCE == null){                    INSTANCE = Room.databaseBuilder(context.getApplicationContext(),                            UsersDatabase.class, &quot;Sample.db&quot;)                            .build();                }            }        }        return INSTANCE;    }</code></pre><p>è¿™æ˜¯å•ä¾‹æ¨¡å¼å¯¹è±¡ INSTANCE çš„è·å¾—æ–¹æ³•ï¼Œä¸æ˜ç™½çš„åŒå­¦å¯ä»¥å»çœ‹æˆ‘è¿™ç¯‡ <a href="https://blog.csdn.net/qq_43377749/article/details/96324909" target="_blank" rel="noopener">å•ä¾‹æ¨¡å¼-å…¨å±€å¯ç”¨çš„ context å¯¹è±¡ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></p><h4 id="UserDataSource"><a href="#UserDataSource" class="headerlink" title="UserDataSource"></a>UserDataSource</h4><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šç»å¤§å¤šæ•°çš„æ•°æ®åº“æ“ä½œæ–¹æ³•ï¼Œéƒ½å®šä¹‰åœ¨äº† <code>UserDao</code> ä¸­ï¼Œè™½ç„¶ä¸€èˆ¬æ³¨è§£ç±»çš„æ–¹æ³•ä¸ä¼šè¢«ç»§æ‰¿ï¼Œä½†æ˜¯æœ‰äº›è¢«ç‰¹æ®Šæ ‡è®°çš„æ–¹æ³•å¯èƒ½ä¼šè¢«ç»§æ‰¿ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹‹åè¦å»ºç«‹çš„å¾ˆå¤šåŠŸèƒ½ç±»ä¸­ï¼Œéƒ½éœ€è¦å»è°ƒç”¨ <code>UserDao</code> é‡Œçš„æ–¹æ³•ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå®šä¹‰ <code>UserDataSource</code> æ¥å£ï¼š</p><pre><code class="java">public interface UserDataSource {    /**     * ä»æ•°æ®åº“ä¸­è¯»å–ä¿¡æ¯     * ç”±äºè¯»å–é€Ÿç‡å¯èƒ½ è¿œå¤§äº è§‚å¯Ÿè€…å¤„ç†é€Ÿç‡ï¼Œæ•…ä½¿ç”¨èƒŒå‹ Flowable æ¨¡å¼     * Flowableï¼šhttps://www.jianshu.com/p/ff8167c1d191/     */    Flowable&lt;User&gt; getUser();    /**     * å°†æ•°æ®å†™å…¥æ•°æ®åº“ä¸­     * å¦‚æœæ•°æ®å·²ç»å­˜åœ¨åˆ™è¿›è¡Œæ›´æ–°     * Completable å¯ä»¥çœ‹ä½œæ˜¯ RxJava çš„ Runnale æ¥å£     * ä½†ä»–åªèƒ½è°ƒç”¨ onComplete å’Œ onError æ–¹æ³•ï¼Œä¸èƒ½è¿›è¡Œ mapã€flatMap ç­‰æ“ä½œ     * Completableï¼šhttps://www.jianshu.com/p/45309538ad94     */    Completable insertOrUpdateUser(User user);    /**     * åˆ é™¤æ‰€æœ‰è¡¨ä¸­æ‰€æœ‰ User å¯¹è±¡     */    void  deleteAllUsers();}</code></pre><p>è¯¥æ¥å£å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œæ–¹æ³•å’Œ  <code>UserDao</code>  ä¸€æ‘¸ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸èµ˜è¿°äº†ã€‚</p><h4 id="LocalUserDataSource"><a href="#LocalUserDataSource" class="headerlink" title="LocalUserDataSource"></a>LocalUserDataSource</h4><pre><code class="java">public class LocalUserDataSource implements UserDataSource {    private final UserDao mUserDao;    public LocalUserDataSource(UserDao userDao) {        this.mUserDao = userDao;    }    @Override    public Flowable&lt;User&gt; getUser() {        return mUserDao.getUser();    }    @Override    public Completable insertOrUpdateUser(User user) {        return mUserDao.insertUser(user);    }    @Override    public void deleteAllUsers() {        mUserDao.deleteAllUsers();    }}</code></pre><p>æˆ‘ä»¬å…ˆçœ‹çœ‹å®˜æ–¹çš„è§£æï¼šâ€œä½¿ç”¨ <code>Room</code> æ•°æ®åº“ä½œä¸ºä¸€ä¸ªæ•°æ®æºã€‚â€å³é€šè¿‡è¯¥ç±»çš„å¯¹è±¡æ‰€æŒæœ‰çš„ <code>UserDao</code> å¯¹è±¡ï¼Œè¿›è¡Œæ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚</p><ul><li>åˆ°æ­¤ä¸ºæ­¢ï¼Œæœ‰å…³äº Room å¯¹æ•°æ®åº“çš„æ“ä½œéƒ¨åˆ†å°±è®²å®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œè§†å›¾å±‚æ­å»ºçš„è§£æã€‚</li></ul><hr><h4 id="UserViewModel"><a href="#UserViewModel" class="headerlink" title="UserViewModel"></a>UserViewModel</h4><p>é¦–å…ˆæˆ‘ä»¬å…ˆå®ç° <code>ViewModel</code> ç±»ï¼Œé‚£ä»€ä¹ˆæ˜¯ <code>ViewModel</code> ç±»å‘¢ï¼Ÿä»å­—é¢ä¸Šç†è§£çš„è¯ï¼Œå®ƒè‚¯å®šæ˜¯è·Ÿè§†å›¾ <code>View</code> ä»¥åŠæ•°æ® <code>Model</code> ç›¸å…³çš„ã€‚å…¶å®æ­£åƒå®ƒå­—é¢æ„æ€ä¸€æ ·ï¼Œå®ƒæ˜¯è´Ÿè´£å‡†å¤‡å’Œç®¡ç†å’ŒUIç»„ä»¶ <code>Fragment/Activity</code> ç›¸å…³çš„æ•°æ®ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>ViewModel</code> æ˜¯ç”¨æ¥ç®¡ç†UIç›¸å…³çš„æ•°æ®çš„ï¼ŒåŒæ—¶ <code>ViewModel</code> è¿˜å¯ä»¥ç”¨æ¥è´Ÿè´£UIç»„ä»¶é—´çš„é€šä¿¡ã€‚é‚£ä¹ˆç°åœ¨å°±æ¥çœ‹çœ‹ä»–çš„å…·ä½“å®ç°ï¼š</p><pre><code class="java">public class UserViewModel extends ViewModel {    /**     * UserDataSource æ¥å£     */    private final UserDataSource mDataSource;    private User mUser;    public UserViewModel(UserDataSource dataSource){        this.mDataSource = dataSource;    }    /**     * ä»æ•°æ®åº“ä¸­è¯»å–æ‰€æœ‰ user åç§°     * @return èƒŒå‹å½¢å¼å‘å‡ºæ‰€æœ‰ User çš„åå­—     *     * ç”±äºæ•°æ®åº“ä¸­ User é‡å¯èƒ½å¾ˆå¤§ï¼Œå¯èƒ½ä¼šå› ä¸ºèƒŒå‹å¯¼è‡´å†…å­˜æº¢å‡º     * æ•…é‡‡ç”¨ Flowable æ¨¡å¼ï¼Œå–ä»£ Observable     */    public Flowable&lt;String&gt; getUserName(){        return mDataSource.getUser()                .map(new Function&lt;User, String&gt;() {                    @Override                    public String apply(User user) throws Exception {                        return user.getUserName();                    }                });    }    /**     * æ›´æ–°/æ·»åŠ  æ•°æ®     *     * åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºåˆ™åˆ›å»ºæ–° User è¿›è¡Œå­˜å‚¨     * è‹¥ä¸ä¸ºç©ºï¼Œè¯´æ˜è¯¥ User å­˜åœ¨ï¼Œè¿™è·å¾—å…¶ä¸»é”® &#39;getId()&#39; å’Œä¼ å…¥çš„æ–° Name æ‹¼æ¥ï¼Œç”Ÿæˆæ–° User å­˜å‚¨     * é€šè¿‡ insertOrUpdateUser æ¥å£ï¼Œè¿”å› Comparable å¯¹è±¡ï¼Œç›‘å¬æ˜¯å¦å­˜å‚¨æˆåŠŸ     * @param userName     * @return     */    public Completable updateUserName(String userName) {        mUser = mUser == null                ? new User(userName)                : new User(mUser.getId(), userName);        return mDataSource.insertOrUpdateUser(mUser);    }}</code></pre><p>ä»£ç ç»“æ„éå¸¸ç®€å•ï¼Œ<code>mDataSource</code> å°±æ˜¯æˆ‘ä»¬å‰é¢å»ºç«‹çš„ <code>UserDataSource</code> æ¥å£å¯¹è±¡ï¼Œç”±äºæˆ‘ä»¬çš„æ•°æ®åº“æ“ä½œæ§åˆ¶ç±»ï¼š<code>LocalUserDataSource</code> æ˜¯é€šè¿‡æ˜¯å®ç°è¯¥æ¥å£çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åœ¨å¤–éƒ¨å°† <code>LocalUserDataSource</code> å¯¹è±¡ä¼ å…¥ï¼Œä»è€Œå¯¹ä»–çš„æ–¹æ³•è¿›è¡Œç›¸åº”çš„å›è°ƒï¼Œä¹Ÿå°±æ˜¯å…ˆå®ç°äº†æ‰€éœ€çš„æ•°æ®åº“æ“ä½œã€‚æ¯ä¸ªæ–¹æ³•çš„åŠŸèƒ½ï¼Œæˆ‘å·²ç»åœ¨æ³¨é‡Šä¸­ç»™å‡ºï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°</p><h4 id="ViewModelFactory"><a href="#ViewModelFactory" class="headerlink" title="ViewModelFactory"></a>ViewModelFactory</h4><p>æœ‰ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†è¿›è¡Œæ•°æ®å¤„ç†çš„ <code>ViewModel</code> ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™é‡Œçš„ <code>ViewModelFactory</code> ç±»åˆæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿè®©æˆ‘ä»¬å…ˆçœ‹ä¸‹èŒƒä¾‹ä¸­çš„å®ç°ï¼š</p><pre><code class="java">public class ViewModelFactory implements ViewModelProvider.Factory {    private final UserDataSource mDataSource;    public ViewModelFactory(UserDataSource dataSource) {        mDataSource = dataSource;    }    // ä½ éœ€è¦é€šè¿‡ ViewModelProvider.Factory çš„ create æ–¹æ³•æ¥åˆ›å»º(è‡ªå®šä¹‰çš„) ViewModel    // å‚è€ƒæ–‡æ¡£ï¼šhttps://medium.com/koderlabs/viewmodel-with-viewmodelprovider-factory-the-creator-of-viewmodel-8fabfec1aa4f    @Override    public &lt;T extends ViewModel&gt; T create(@NonNull Class&lt;T&gt; modelClass) {        // ä¸ºä»€ä¹ˆè¿™é‡Œç”¨ isAssignableFrom æ¥åˆ¤æ–­ä¼ å…¥çš„ modelClass ç±»çš„ç±»å‹ï¼Œ è€Œä¸ç›´æ¥ç”¨ isInstance åˆ¤æ–­ï¼Ÿ        // ç­”ï¼šäºŒè€…åŠŸèƒ½ä¸€æ ·ï¼Œä½†å¦‚æœä¼ å…¥å€¼ï¼ˆmodelClass ä¸ºç©ºï¼‰åˆ™ isInstance ä¼šæŠ¥é”™å¥”æºƒï¼Œè€Œ isAssignableFrom ä¸ä¼š        if (modelClass.isAssignableFrom(UserViewModel.class)) {            return (T) new UserViewModel(mDataSource);        }        throw new IllegalArgumentException(&quot;Unknown ViewModel class&quot;);    }}</code></pre><p><code>ViewModelFactory</code> ç»§æ‰¿è‡ª <code>ViewModelProvider.Factory</code> ï¼Œå®ƒè´Ÿè´£å¸®ä½ åˆ›å»º <code>ViewModel</code> å®ä¾‹ã€‚ä½†ä½ ä¹Ÿè®¸ä¼šé—®ï¼Œæˆ‘ä»¬ä¸æ˜¯å·²ç»æœ‰äº† <code>ViewModel</code> çš„æ„é€ æ–¹æ³•äº†å—ï¼Ÿåœ¨ç”¨ <code>ViewModelFactory</code> ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Ÿå¦‚æœè¿˜ä¸ç†Ÿæ‚‰ <code>ViewModelFactory</code> æœ‰å…³å†…å®¹çš„ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡ï¼š<a href="https://blog.csdn.net/qq_43377749/article/details/100856599" target="_blank" rel="noopener">ViewModel å’Œ ViewModelProvider.Factoryï¼šViewModel çš„åˆ›å»ºè€…</a></p><h4 id="Injection"><a href="#Injection" class="headerlink" title="Injection"></a>Injection</h4><p>å…³äº <code>Injection</code> ï¼Œè¿™æ˜¯ä¸ªå¸®åŠ©ç±»ï¼Œå®ƒå’Œ Room çš„é€»è¾‘åŠŸèƒ½å¹¶æ²¡æœ‰å…³ç³»ã€‚<code>Sample</code> ä¸­å°†å…¶ç‹¬ç«‹å‡ºæ¥ç”¨äºå„ä¸ªå¯¹è±¡ã€ç±»å‹çš„æ³¨å…¥ï¼Œå…ˆè®©æˆ‘ä»¬çœ‹ä¸‹è¯¥ç±»çš„å®ç°ï¼š</p><pre><code class="java">public class Injection {    /**     * é€šè¿‡è¯¥æ–¹æ³•å®ä¾‹åŒ–å‡ºèƒ½æ“ä½œæ•°æ®åº“çš„ LocalUserDataSource å¯¹è±¡     * @param context     * @return     */    public static UserDataSource provideUserDateSource(Context context) {        // è·å¾— RoomDatabase        UsersDatabase database = UsersDatabase.getInstance(context);        // å°†å¯æ“ä½œ UserDao ä¼ å…¥        // å®ä¾‹åŒ–å‡ºå¯æ“ä½œ LocalUserDataSource å¯¹è±¡æ–¹ä¾¿å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ        return new LocalUserDataSource(database.userDao());    }    /**     * è·å¾— ViewModelFactory å¯¹è±¡     * ä¸º ViewModel å®ä¾‹åŒ–ä½œå‡†å¤‡     * @param context     * @return     */    public static ViewModelFactory provideViewModelFactory(Context context) {        UserDataSource dataSource = provideUserDateSource(context);        return new ViewModelFactory(dataSource);    }}</code></pre><p>è¯¥ç±»æœ‰ä¸¤ä¸ªæ–¹æ³•ç»„æˆï¼Œå®ç°äº†å„ä¸ªç±»å‹æ•°æ®ç›¸äº’é—´çš„è½¬æ¢ï¼Œæƒ³å†è®©æˆ‘ä»¬å…ˆçœ‹ä¸‹ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼š</p><pre><code class="java">    /**     * é€šè¿‡è¯¥æ–¹æ³•å®ä¾‹åŒ–å‡ºèƒ½æ“ä½œæ•°æ®åº“çš„ LocalUserDataSource å¯¹è±¡     * @param context     * @return     */    public static UserDataSource provideUserDateSource(Context context) {        // è·å¾— RoomDatabase        UsersDatabase database = UsersDatabase.getInstance(context);        // å°†å¯æ“ä½œ UserDao ä¼ å…¥        // å®ä¾‹åŒ–å‡ºå¯æ“ä½œ LocalUserDataSource å¯¹è±¡æ–¹ä¾¿å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ        return new LocalUserDataSource(database.userDao());    }</code></pre><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥åˆ°äº†æˆ‘ä»¬çš„ <code>context</code> å¯¹è±¡ï¼Œé€šè¿‡ <code>UsersDatabase.getInstance(context)</code> æ–¹æ³•ï¼Œè®© <code>database</code> æŒæœ‰ <code>context</code> ï¼Œå®ç°æ•°æ®åº“çš„é“¾æ¥å’Œåˆå§‹åŒ–ã€‚åŒæ—¶æ”¾å›ä¸€ä¸ª <code>LocalUserDataSource</code> å¯¹è±¡ï¼Œè¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±å¯ä»¥å¯¹æ•°æ®è¡¨ä¸­çš„å†…å®¹æƒŠé†’ç›¸åº”çš„æ“ä½œã€‚</p><pre><code class="java">    /**     * è·å¾— ViewModelFactory å¯¹è±¡     * ä¸º ViewModel å®ä¾‹åŒ–ä½œå‡†å¤‡     * @param context     * @return     */    public static ViewModelFactory provideViewModelFactory(Context context) {        UserDataSource dataSource = provideUserDateSource(context);        return new ViewModelFactory(dataSource);    }</code></pre><p>è¯¥æ–¹æ³•çš„åŠŸèƒ½éå¸¸æ˜ç¡®ï¼Œå°±æ˜¯ä¸ºæˆ‘ä»¬å®ä¾‹åŒ–å‡ºä¸€ä¸ª <code>ViewModelFactory</code> å¯¹è±¡ï¼Œä¸ºæˆ‘ä»¬å¾€ååˆ›å»º <code>ViewModel</code> ä½œå‡†å¤‡ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬è°ƒç”¨äº†å‰é¢çš„ <code>provideUserDateSource</code> æ–¹æ³•ï¼Œé€šè¿‡è¯¥æ–¹æ³•è·å¾—äº†å¯¹æ•°æ®åº“æ“ä½œçš„ <code>LocalUserDataSource</code> å¯¹è±¡ï¼Œè¿™é‡Œæˆ‘ä»¬å°±çœ‹åˆ°äº†å•ä¾‹æ¨¡å¼ä½¿ç”¨çš„å…ˆè§æ€§ï¼Œä½¿å¾—æ•°æ®åº“ä¸ä¼šè¢«åå¤çš„åˆ›å»ºã€è¿æ¥ã€‚</p><ul><li>å¥½äº†ï¼Œè‡³æ­¤æ‰€æœ‰å‡†å¤‡å·¥ä½œéƒ½å·²ç»å®Œæˆï¼Œè®©æˆ‘ä»¬å¼€å§‹è§†å›¾å±‚ UserActivity çš„è°ƒç”¨</li><li>ç”±äº <code>UserActivity</code> çš„å†…å®¹è¾ƒå¤šæˆ‘å°±ä¸è´´å®Œæ•´çš„ä»£ç ï¼Œæˆ‘ä»¬é€æ­¥è¿›è¡Œè®²è§£</li></ul><hr><h4 id="å‡†å¤‡æ•°æ®æˆå‘˜"><a href="#å‡†å¤‡æ•°æ®æˆå‘˜" class="headerlink" title="å‡†å¤‡æ•°æ®æˆå‘˜"></a>å‡†å¤‡æ•°æ®æˆå‘˜</h4><p>é¦–å…ˆæˆ‘ä»¬å‡†å¤‡äº†æ‰€éœ€çš„ç»™ç±»æ•°æ®æˆå‘˜ï¼š</p><pre><code class="java">    private static final String TAG = UserActivity.class.getSimpleName();    private TextView mUserName;    private EditText mUserNameInput;    private Button mUpdateButton;    // ä¸€ä¸ª ViewModel ç”¨äºè·å¾— Activity &amp; Fragment å®ä¾‹    private ViewModelFactory mViewModelFactory;    // ç”¨äºè®¿é—®æ•°æ®åº“    private UserViewModel mViewModel;    // disposable æ˜¯è®¢é˜…äº‹ä»¶ï¼Œå¯ä»¥ç”¨æ¥å–æ¶ˆè®¢é˜…ã€‚é˜²æ­¢åœ¨ activity æˆ–è€… fragment é”€æ¯åä»ç„¶å ç”¨ç€å†…å­˜ï¼Œæ— æ³•é‡Šæ”¾ã€‚    private final CompositeDisposable mDisposable = new CompositeDisposable();</code></pre><ul><li>é¦–å…ˆç•Œé¢æ“ä½œçš„å„ä¸ªæ§ä»¶</li><li>æ¥è¿™å°±æ˜¯ <code>mViewModelFactory</code> ã€ <code>mViewModel</code> ä¸¤ä¸ªæ•°æ®æˆå‘˜ï¼Œç”¨äºè´Ÿè´£æ•°æ®æºçš„æ“ä½œ</li><li>å†å°±æ˜¯ä¸€ä¸ª <code>CompositeDisposable</code> å¯¹è±¡ï¼Œç”¨äºç®¡ç†è®¢é˜…äº‹ä»¶ï¼Œé˜²æ­¢ Activity ç»“æŸåï¼Œè®¢é˜…ä»åœ¨è¿›è¡Œçš„æƒ…å†µ</li></ul><h4 id="onCreate"><a href="#onCreate" class="headerlink" title="onCreate"></a>onCreate</h4><p>æ§ä»¶ã€æ•°æ®æºå±‚ã€æ•°æ®åº“ç­‰çš„åˆå§‹åŒ–</p><pre><code class="java">    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_user);        mUserName = findViewById(R.id.user_name);        mUserNameInput = findViewById(R.id.user_name_input);        mUpdateButton = findViewById(R.id.update_user);        // å®ä¾‹åŒ– ViewModelFactory å¯¹è±¡ï¼Œå‡†å¤‡å®ä¾‹åŒ– ViewModel        mViewModelFactory = Injection.provideViewModelFactory(this);        mViewModel = new ViewModelProvider(this, mViewModelFactory).get(UserViewModel.class);        mUpdateButton.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                updateUserName();            }        });    }</code></pre><ul><li>é¦–å…ˆæ˜¯å„ç±»æ§ä»¶çš„åˆå§‹åŒ–</li><li>æ¥ç€æ˜¯ <code>ViewModel</code> çš„åˆå§‹åŒ–ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå°±å®ç°äº†æ•°æ®åº“çš„é“¾æ¥</li><li>ç”¨æˆ·ä¿¡æ¯æŒ‰é’®ç›‘å¬å™¨ç»‘å®šï¼Œç‚¹å‡»æ‰§è¡Œ <code>updateUserName</code> æ–¹æ³•å¦‚ä¸‹</li></ul><h4 id="updateUserName"><a href="#updateUserName" class="headerlink" title="updateUserName"></a>updateUserName</h4><p>ä¿®æ”¹æ•°æ®åº“ä¸­ç”¨æˆ·ä¿¡æ¯</p><pre><code class="java">    private void updateUserName() {        String userName = mUserNameInput.getText().toString();        // åœ¨å®Œæˆç”¨æˆ·åæ›´æ–°ä¹‹å‰ç¦ç”¨â€œæ›´æ–°â€æŒ‰é’®        mUpdateButton.setEnabled(false);        // å¼€å¯è§‚å¯Ÿè€…æ¨¡å¼        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼Œç»“æŸåé‡æ–°å¼€å¯æŒ‰é’®        mDisposable.add(mViewModel.updateUserName(userName)        .subscribeOn(Schedulers.io())        .observeOn(AndroidSchedulers.mainThread())        .subscribe(new Action() {            @Override            public void run() throws Exception {                mUpdateButton.setEnabled(true);            }        }, new Consumer&lt;Throwable&gt;() {            @Override            public void accept(Throwable throwable) throws Exception {                Log.d(TAG, &quot;accept: Unable to update username&quot;);            }        }));    }</code></pre><ul><li>è·å¾—æ–°çš„ç”¨æˆ·å</li><li>å°†æŒ‰é’®è®¾ä¸ºä¸å¯ç‚¹å‡»</li><li>åœ¨ <code>io</code> çº¿ç¨‹ä¸­è®¿é—®æ•°æ®åº“è¿›è¡Œä¿®æ”¹</li><li>åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹è¿›è¡Œç›¸åº”å¤„ç†ï¼Œæ¯”å¦‚è®©æŒ‰é’®æ¢å¤åˆ°å¯ç‚¹å‡»çŠ¶æ€</li></ul><h4 id="onStart"><a href="#onStart" class="headerlink" title="onStart"></a>onStart</h4><p>åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯ï¼Œä¿®æ”¹ <code>UI</code> ç•Œé¢å†…å®¹</p><pre><code class="java">    @Override    protected void onStart() {        super.onStart();        // è§‚å¯Ÿè€…æ¨¡å¼        // é€šè¿‡ ViewModel ä»æ•°æ®åº“ä¸­è¯»å– UserName æ˜¾ç¤º        // å¦‚æœè¯»å–å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯        mDisposable.add(mViewModel.getUserName()                .subscribeOn(Schedulers.io())                .observeOn(AndroidSchedulers.mainThread())        .subscribe(new Consumer&lt;String&gt;() {            @Override            public void accept(String s) throws Exception {                mUserName.setText(s);            }        }, new Consumer&lt;Throwable&gt;() {            @Override            public void accept(Throwable throwable) throws Exception {                Log.e(TAG, &quot;Unable to update username&quot;);            }        }));    }</code></pre><ul><li>åœ¨ <code>io</code> çº¿ç¨‹ä¸­è¿›è¡Œæ•°æ®åº“è®¿é—®</li><li>åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ï¼Œä¿®æ”¹ <code>UI</code> ä¿¡æ¯</li></ul><h4 id="onStop"><a href="#onStop" class="headerlink" title="onStop"></a>onStop</h4><p>å–æ¶ˆè®¢é˜…</p><pre><code class="java">    @Override    protected void onStop() {        super.onStop();        // å–æ¶ˆè®¢é˜…ã€‚é˜²æ­¢åœ¨ activity æˆ–è€… fragment é”€æ¯åä»ç„¶å ç”¨ç€å†…å­˜ï¼Œæ— æ³•é‡Šæ”¾ã€‚        mDisposable.clear();    }</code></pre><ul><li>é€šè¿‡æˆ‘ä»¬ä¹‹å‰å®ä¾‹åŒ–çš„ <code>CompositeDisposable</code> å¯¹è±¡ï¼Œè§£é™¤è®¢é˜…å…³ç³»</li></ul><hr><h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1><h4 id="Demo-åœ°å€"><a href="#Demo-åœ°å€" class="headerlink" title="Demo åœ°å€"></a>Demo åœ°å€</h4><p><a href="https://github.com/FishInWater-1999/ArchitectureComponentsStudy" target="_blank" rel="noopener">ArchitectureComponentsStudy</a></p><hr><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul><li>å­¦ä¼šä½¿ç”¨ <code>Android Architecture Components</code> æä¾›çš„ç»„ä»¶ç®€åŒ–æˆ‘ä»¬çš„å¼€å‘ï¼Œèƒ½å¤Ÿä½¿æˆ‘ä»¬å¼€å‘çš„åº”ç”¨æ¨¡å—æ›´è§£è€¦æ›´ç¨³å®šï¼Œè§†å›¾ä¸æ•°æ®æŒä¹…å±‚åˆ†ç¦»ï¼Œä»¥åŠæ›´å¥½çš„æ‰©å±•æ€§ä¸çµæ´»æ€§ã€‚æœ€åï¼Œç å­—ä¸æ˜“ï¼Œåˆ«å¿˜äº†ç‚¹ä¸ªèµå“¦</li></ul>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Room</tag>
      
      <tag>RxJava</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>